(function(e){var b="undefined",c="function",d,a,f=function(j,h){var i,g;if(!h.test(j.type)){return null}i=document.createElement("img");if(typeof URL!==b&&typeof URL.createObjectURL===c){i.src=URL.createObjectURL(j);i.onload=function(){URL.revokeObjectURL(this.src)};return i}if(typeof FileReader!==b){g=new FileReader();if(typeof g.readAsDataURL===c){g.onload=function(k){i.src=k.target.result};g.readAsDataURL(j);return i}}return null};d=function(h,j){var g=this,i,k;this.dropZone=h;this.imageTypes=/^image\/(gif|jpeg|png)$/;this.previewSelector=".file_upload_preview";this.progressSelector=".file_upload_progress div";this.cancelSelector=".file_upload_cancel button";this.cssClassSmall="file_upload_small";this.cssClassLarge="file_upload_large";this.cssClassHighlight="file_upload_highlight";this.dropEffect="highlight";this.uploadTable=this.downloadTable=null;this.buildUploadRow=this.buildDownloadRow=function(){return null};this.addNode=function(l,m,n){if(m){m.css("display","none").appendTo(l).fadeIn(function(){if(typeof n===c){try{n()}catch(o){e(this).stop();throw o}}})}else{if(typeof n===c){n()}}};this.removeNode=function(l,m){if(l){l.fadeOut(function(){e(this).remove();if(typeof m===c){try{m()}catch(n){e(this).stop();throw n}}})}else{if(typeof m===c){m()}}};this.onAbort=function(o,n,l,p,m){m.removeNode(m.uploadRow)};this.cancelUpload=function(p,o,m,q,n){var l=q.readyState;q.abort();if(isNaN(l)||l<2){n.onAbort(p,o,m,q,n)}};this.initProgressBar=function(m,n){if(typeof m.progressbar===c){return m.progressbar({value:n})}else{var l=e('<progress value="'+n+'" max="100"/>').appendTo(m);l.progressbar=function(o,p){l.attr("value",p)};return l}};this.initUploadRow=function(o,n,l,r,m,p){var q=m.uploadRow=m.buildUploadRow(n,l,m);if(q){m.progressbar=m.initProgressBar(q.find(m.progressSelector),(r.upload?0:100));q.find(m.cancelSelector).click(function(s){m.cancelUpload(s,n,l,r,m)});q.find(m.previewSelector).each(function(){e(this).append(new f(n[l],m.imageTypes))})}m.addNode((typeof m.uploadTable===c?m.uploadTable(m):m.uploadTable),q,p)};this.initUpload=function(o,n,l,q,m,p){m.initUploadRow(o,n,l,q,m,function(){if(typeof m.beforeSend===c){m.beforeSend(o,n,l,q,m,p)}else{p()}})};this.onProgress=function(o,n,l,p,m){if(m.progressbar){m.progressbar.progressbar("value",parseInt(o.loaded/o.total*100,10))}};this.parseResponse=function(l){if(typeof l.responseText!==b){return e.parseJSON(l.responseText)}else{return e.parseJSON(l.contents().text())}};this.initDownloadRow=function(l,m,p,r,s,n){var t,o;try{t=s.response=s.parseResponse(r);o=s.downloadRow=s.buildDownloadRow(t,s);s.addNode((typeof s.downloadTable===c?s.downloadTable(s):s.downloadTable),o,n)}catch(q){if(typeof s.onError===c){s.originalEvent=l;s.onError(q,m,p,r,s)}else{throw q}}};this.onLoad=function(o,n,l,p,m){m.removeNode(m.uploadRow,function(){m.initDownloadRow(o,n,l,p,m,function(){if(typeof m.onComplete===c){m.onComplete(o,n,l,p,m)}})})};this.dropZoneEnlarge=function(){if(!k){if(typeof g.dropZone.switchClass===c){g.dropZone.switchClass(g.cssClassSmall,g.cssClassLarge)}else{g.dropZone.addClass(g.cssClassLarge);g.dropZone.removeClass(g.cssClassSmall)}k=true}};this.dropZoneReduce=function(){if(typeof g.dropZone.switchClass===c){g.dropZone.switchClass(g.cssClassLarge,g.cssClassSmall)}else{g.dropZone.addClass(g.cssClassSmall);g.dropZone.removeClass(g.cssClassLarge)}k=false};this.onDocumentDragEnter=function(l){g.dropZoneEnlarge()};this.onDocumentDragOver=function(l){if(i){clearTimeout(i)}i=setTimeout(function(){g.dropZoneReduce()},200)};this.onDragEnter=this.onDragLeave=function(l){g.dropZone.toggleClass(g.cssClassHighlight)};this.onDrop=function(l){if(i){clearTimeout(i)}if(g.dropEffect&&typeof g.dropZone.effect===c){g.dropZone.effect(g.dropEffect,function(){g.dropZone.removeClass(g.cssClassHighlight);g.dropZoneReduce()})}else{g.dropZone.removeClass(g.cssClassHighlight);g.dropZoneReduce()}};e.extend(this,j)};a={init:function(g){return this.each(function(){e(this).fileUpload(new d(e(this),g))})},option:function(h,i,g){if(typeof h===b||(typeof h==="string"&&typeof i===b)){return e(this).fileUpload("option",h,i,g)}return this.each(function(){e(this).fileUpload("option",h,i,g)})},destroy:function(g){return this.each(function(){e(this).fileUpload("destroy",g)})}};e.fn.fileUploadUI=function(g){if(a[g]){return a[g].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof g==="object"||!g){return a.init.apply(this,arguments)}else{e.error("Method "+g+" does not exist on jQuery.fileUploadUI")}}}}(jQuery));