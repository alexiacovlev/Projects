AX.NotificationCenter=function(){this.period=2*60*1000;this._check=$createDelegate(this.check,this);this._oncheck_completed=$createDelegate(this.oncheck_completed,this);this._oncheck_failed=$createDelegate(this.oncheck_failed,this);this.taskCount=0;this.timerid=null;this.$appEvents=$("#appEvents");if(this.$appEvents.length==0){return}var a=$(this.$appEvents[0].firstChild);this.$counter=$("<b class='app-count'></b>");a.append(this.$counter);a.css("cursor","pointer").addHandler("click",this.loadPersonalPanel,this);this.check()};AX.NotificationCenter.prototype={check:function(){ExecuteService("{}",App.SystemPath+"Controls/Notify/Service.asmx/Check",this._oncheck_completed,this._oncheck_failed)},oncheck_completed:function(a){var b=a.d;if(!b){this.wait();return}if(this.taskCount!=b.TaskCount){this.taskCount=b.TaskCount;this.$counter.text(b.TaskCount>0?b.TaskCount:"").hide().fadeIn()}this.list=b.Messages;this.index=0;if(this.list.length>0){this.showNextMessage()}else{this.wait()}},oncheck_failed:function(a){this.wait()},showNextMessage:function(){var a=this.index;if(a<this.list.length){var e=new AX.WindowPanel(this.list[a].Header,this.list[a].Text,true);var f=$createDelegate(this.mark_as_read,this);var d=$createDelegate(this.postpone,this);var c=$("<a class='fm-btn' style='width:60px;font-weight:bold;padding-bottom:3px;'>OK</a>").click(function(){e.close();f()});var b=$("<a class='fm-btn' style='margin-left:8px;padding-bottom:3px;'>Remind me later</a>").click(function(){e.close();d()});e.init([c,b]);e.show()}else{this.wait()}},mark_as_read:function(){ExecuteService('{ID:"'+this.list[this.index].ID+'"}',App.SystemPath+"Controls/Notify/Service.asmx/MarkAsRead");this.index+=1;this.showNextMessage()},postpone:function(){this.index+=1;this.showNextMessage()},wait:function(){if(App.isLocked){return}if(this.timerid!=null){window.clearTimeout(this.timerid)}this.timerid=window.setTimeout(this._check,this.period)},loadPersonalPanel:function(a){if(!this.$panel){this.$panel=$("<div class='fm-popup'></div>");$(document.body).append(this.$panel);this.$panel.addHandler("blur",function(){this.$panel.hide()},this);this.$panel.addHandler("mousedown",this.panel_click,this)}this.$panel.hide();this.$panel.loadASCX(App.SystemPath+"Controls/Notify/PersonalPanel.ascx",null,$createDelegate(this.showPersonalPanel,this))},showPersonalPanel:function(d){var b=this.$appEvents;var h=b.position();var a=h.left;var g=h.top+b.outerHeight();var f=$(document.body).width();var c=this.$panel.width();if(c<250){c=250}if(a+c+10>f){a=f-c-10}this.$panel.css({left:a,top:-this.$panel.outerHeight(),minWidth:c});this.$panel.attr("tabIndex",100);this.$panel.show().animate({top:g+5},{duration:800,easing:"easeOutBounce"});this.$panel.focus()},panel_click:function(c){var d=c.target;var a=0;while(d.tagName!="A"&&a++<5){d=$(d).parent()[0]}var b=d.getAttribute("oid");if(!b){if(window.location.href.indexOf("#MyProfile/MY_Tasks")!=-1){this.$panel.hide()}else{window.location.href="#MyProfile/MY_Tasks"}}else{window.fmOpenHandler("CUSTOM/TASKDIALOG",null,"OPEN","id="+b,"700,450",null)}}};App.Notify=new AX.NotificationCenter();if(!jQuery.easing.easeOutBounce){jQuery.easing.easeOutBounce=function(e,f,a,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+a}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}}};