// Profile Builder Client Script Library
// Alfa-XP, Michael Isipciuc, 2012.
//
RMC.ProfileBuilder=function(c,b,a){this.$p=c;this.data=b;this._window=a;if(typeof(a.setHeader)=="function"){a.setHeader(this.data.p+" / "+this.data.r+" - Profile Builder")}this.profileName=this.data.p;this.groupName=this.data.r;this.folderName=this.data.f;this._selected=null;if(!RMC.ProfileBuilder.template){$.get(RMC.Path+"ProfileBuilder/designer.aspx",$createDelegate(function(d){RMC.ProfileBuilder.template=d;this.init()},this))}else{this.init()}this.storageXmlParser=xml_createParser()};RMC.ProfileBuilder.prototype={init:function(){this.$p.html(RMC.ProfileBuilder.template);this.$tree=$("#_tree",this.$p);this.$nodeStorage=$("#_nodeStorage",this.$p);this.$gridStorage=$(this.$nodeStorage.children()[0]);this.$ctrlStorage=$(this.$nodeStorage.children()[1]);this.$nodeProperties=$("#_nodeProperties",this.$p);this.$buttonsBar=$("#_buttons",this.$p);this.initControls();var a='{"profileName":"'+this.profileName+'","groupName":"'+this.groupName+'","folderName":"'+this.folderName+'"}';ExecuteService(a,RMC.Path+"ProfileBuilder/SupportService.asmx/LoadTree",$.proxy(this.onLoadTree,this),_fm_onHandlerError)},onLoadTree:function(a){var b=a.d;this.groupName=b.Data;this.$tree.html(b.Value);this.selectByName(this.folderName);this.$panelCreate.toggle(this.groupName=="Members");this.$btnCreate.toggle(this.groupName=="Members")},initControls:function(){this.$tree.addHandler("mousedown",this.OnNodeClick,this);this.$buttonsBar.addHandler("click",this.btn_click,this);$("#lnkMore").click(function(){$("#tbMoreActions").toggle()});$("#btnMenu").click($.proxy(this.openMenuBuilder,this));this.$cbGridOnly=$("#cbGridOnly",this.$nodeProperties);this.$imgLogo=$("#imgLogo",this.$nodeProperties);this.$nodeName=$("#_nodeName",this.$p);this.$nodeInfo=$("#_nodeInfo",this.$p);this.$infoLabel=this.$nodeInfo.next();this.$tbLabel=$("#tbLabel",this.$nodeProperties);this.imgIcon=new FM.ImageControl($("#imgIcon",this.$nodeProperties),null,"change icon");this.$tbLabel.on("change",$createDelegate(this.lable_changed,this));this.$cbAllowAutoCount=$("#cbAllowAutoCount",this.$nodeProperties);this.$cbAllowAutoCount.addHandler("click",this.folder_checkbox_click,this);$("#btnMore",this.$nodeProperties).addHandler("click",this.folder_more_properties,this);$("#_treeButtons").addHandler("click",this.tree_btn_click,this);$("#btnChange").addHandler("click",this.change_content_click,this);this.tbTableName=new FM.LookupTextControl($("#tbTableName",this.$gridStorage));this.tbViewName=new FM.LookupTextControl($("#tbViewName",this.$gridStorage),this.tbTableName);this.tbSelectAction=new FM.LookupTextControl($("#tbSelectAction",this.$gridStorage),this.tbTableName,FM.ActionSelectorHandler);this.paramsSelect=new FM.WindowParameters($("#paramsSelect",this.$gridStorage));this.tbCreateAction=new FM.LookupTextControl($("#tbCreateAction",this.$gridStorage),this.tbTableName,FM.ActionSelectorHandler);this.paramsCreate=new FM.WindowParameters($("#paramsCreate",this.$gridStorage));this.cbOnRecordOpen=$("#cbOnRecordOpen",this.$gridStorage);this.tbMoreActions=$("#tbMoreActions",this.$gridStorage);this.cbAddCreate=$("#cbAddCreate",this.$gridStorage);this.tbAddCreate=$("#tbAddCreate",this.$gridStorage);this.cbAddDelete=$("#cbAddDelete",this.$gridStorage);this.tbAddDelete=$("#tbAddDelete",this.$gridStorage);this.cbAddExport=$("#cbAddExport",this.$gridStorage);this.cbShowActionsMenu=$("#cbShowActionsMenu",this.$gridStorage);this.panelSearchMode=new FM.RadioGroup($("div#panelSearchMode",this.$gridStorage));this.panelSearchMode.change(this.onSearchMode_changed,this);this.tbInputFilterField=new FM.LookupTextControl($("#tbInputFilterField",this.$gridStorage),this.tbTableName);this.$panelCreate=$("#panelCreate",this.$p);this.$panelCreate.click(function(){$(this).hide()});this.$btnCreate=$("#btnCreate",this.$p);this.cbShowChart=$("#cbShowChart",this.$gridStorage);this.linkChart=$("#linkChart",this.$gridStorage);this.linkChart.addHandler("click",this.chart_settings,this);this.cbShowInfo=$("#cbShowInfo",this.$gridStorage);RMC_initTooltip($("#imgFilterHelp",this.$gridStorage))},selectByName:function(c){if(!c){return}var b=$('a[n="'+c+'"]',this.$tree);if($isNull(b)){b=$("a:first",this.$tree)}if(!$isNull(b)){this.selectNode(b)}},OnNodeClick:function(f){var g=f.target;if(g.tagName=="SPAN"){var c=$(g);var d=c.next().next();var h=c.attr("class");if(h=="plus"){c.removeClass(h).addClass("minus");d.css({display:"block"})}else{if(h=="minus"){c.removeClass(h).addClass("plus");d.css({display:"none"})}}}else{if(g.tagName=="IMG"){g=g.parentNode}if(g.tagName=="LABEL"){g=g.parentNode}if(g.tagName=="A"){f.stopPropagation();f.preventDefault();var b=$(g);if(this._node!=null&&this._node[0]==g){this.startMoving(f,b)}else{this.selectNode(b)}}}},selectNode:function(b){this.updateFolder=false;if(this._node){this._node.removeClass("sel")}this._node=b;this._node.addClass("sel");this.folderName=b.attr("n");if(this.folderName==""){this.$nodeName.text(" ( Root )")}else{this.$nodeName.text(" ("+this.folderName+")")}this.$nodeInfo.text("");this.mapNode=null;this.nodeControl=b.attr("c");if(this.nodeControl!=""){var f='{"profileName":"'+this.profileName+'","groupName":"'+this.groupName+'","folderName":"'+this.folderName+'"}';ExecuteService(f,FM.Path+"Explorer/ProfileBuilder/SupportService.asmx/LoadNodeStorage",$.proxy(this.onLoadState,this),_fm_onHandlerError)}else{this.onLoadState(null)}var e=$(b.children()[0]);var c=$(e.children()[0]);this.nodeTitle=e.text();this.nodeIcon=c.attr("src").replace("/ASP.Net/Images/ico/","");this.nodeLogo=c.attr("i")||"";this.nodeData=b.attr("d");this.$tbLabel.val(this.nodeTitle);this.imgIcon.setValue(this.nodeIcon,this.nodeLogo);this.imgIcon.onchange_callback=$createDelegate(this.icon_onchange,this);var g=this.nodeData.split(",");this.$cbAllowAutoCount.attr("checked",g[0]!="false")},onLoadState:function(n){this.$nodeStorage.children().hide();this.$cbGridOnly.hide();if(!n){this.showEmptyContent();return}var i=n.d;if(i.Error!=null){AX.Window.alert("Folder Properties",i.Error);return}this.storageDoc=xml_loadXML(this.storageXmlParser,i.Value);this.mapNode=$(":first",this.storageDoc);var k=this.mapNode.attr("type");if(k=="GRID"){this.$gridStorage.show();this.$cbGridOnly.show();var m=this.getValue("TableName");this.tbTableName.setValue(m);this.tbViewName.setValue(this.getValue("ViewName"));this.tbSelectAction.setValue(this.getValue("OpenForm"));this.paramsSelect.setValue(this.getValue("HandlerParameters"));this.tbCreateAction.setValue(this.getValue("CreateForm"));this.paramsCreate.setValue(this.getValue("CreateParameters"));this.cbOnRecordOpen.val(this.getValue("OnRecordOpen"));var g=this.getValue("CustomActionsXml");this.tbMoreActions.val(g);this.cbAddCreate.attr("checked",this.getValue("AllowCreate")!="false");this.tbAddCreate.val(this.getValue("Label_NEW"));this.cbAddDelete.attr("checked",this.getValue("AllowDelete")!="false");this.tbAddDelete.val(this.getValue("Label_DELETE"));this.cbShowActionsMenu.attr("checked",this.getValue("ShowActionsMenu")!="false");this.cbAddExport.attr("checked",this.getValue("AllowExport")=="true");this.tbInputFilterField.setValue(this.getValue("InputFilterField"));var f=this.getValue("SearchMode");if(this.getValue("ShowGridFilterPanel")=="false"){f="None"}this.panelSearchMode.setValue(f,"");this.onSearchMode_changed();if(f=="ByForm"){$("#cbSearchStore",this.$p).prop("checked",this.getValue("SearchStore")=="true");$("#cbResultsByRequestOnly",this.$p).prop("checked",this.getValue("ResultsByRequestOnly")=="true")}var j=this.getValue("ChartSettings");var c=j!=""&&(j.indexOf("|")==0);this.linkChart.attr("settings",j);this.cbShowChart.attr("checked",c);this.cbShowInfo.attr("checked",this.getValue("ShowInfo")=="true");if(m==""){this.tbTableName.$btn.click()}}else{if(k!=""){this.$ctrlStorage.show();this.$ctrlStorage.children().hide();var h=this.mapNode.attr("content");switch(k){case"WORKFLOW":$("#pnl_Workflow",this.$ctrlStorage).show();if(!this.tbWorkflowName){this.tbWorkflowName=new FM.LookupTextControl($("#tbWorkflowName",this.$ctrlStorage))}this.tbWorkflowName.setValue(this.getValue("WorkflowName"));break;case"FORM":$("#pnl_FORM",this.$ctrlStorage).show();if(!this.tbForm_TableName){this.tbForm_TableName=new FM.LookupTextControl($("#tbForm_TableName",this.$ctrlStorage))}if(!this.tbForm_Name){this.tbForm_Name=new FM.LookupTextControl($("#tbForm_Name",this.$ctrlStorage),this.tbForm_TableName)}this.tbForm_TableName.setValue(this.getValue("TableName"));this.tbForm_Name.setValue(this.getValue("FormName"));break;case"SERVERCONTROL":$("#pnl_Control",this.$ctrlStorage).show();var a="",e="",d="";if(h.indexOf(".ascx")>0){a=h}else{if(h.indexOf(",")>0){var b=h.split(",");e=b[0];d=b[1]}}$("#tbControl_Ascx",this.$ctrlStorage).val(a);$("#tbControl_Assembly",this.$ctrlStorage).val(e);$("#tbControl_FullName",this.$ctrlStorage).val(d);this.loadAssignedProperties();break;default:$("#pnl_Custom",this.$ctrlStorage).show();$("#tbCustom_Type",this.$ctrlStorage).val(k);$("#tbCustom_Content",this.$ctrlStorage).val(h);break}}}this.setLogo(k);var l=this.mapNode.attr("modifiedon");if(l){this.$nodeInfo.text("last modified on "+l+" by "+this.mapNode.attr("modifiedby"))}},loadAssignedProperties:function(){var f=$("table#pnlControl_Properties",this.$ctrlStorage);$("TR",f).remove();var b=this.mapNode.children();var a;for(var d=0;d<b.length;d++){var c=b[d].getAttribute("name");var e=b[d].getAttribute("value");a=$("<tr><td><label class='fm-lbl'></label></td><td><input class='fm' /></td></tr>");f.append(a);$("label",a).text(c);$("input",a).val(e)}},saveAssignedProperties:function(){var e=$("table#pnlControl_Properties",this.$ctrlStorage)[0].rows;var b=this.mapNode.children();var f,a;for(var d=0;d<b.length;d++){f=b[d];a=$(e[d]);var c=f.getAttribute("name");var g=$("input",a).val().trim();f.setAttribute("value",g)}},showEmptyContent:function(){this.setLogo("");var a=$(this.$nodeStorage.children()[2]);a.show()},Save:function(h){this.closeOnSave=h;var b="";if(this.mapNode!=null){var g=this.mapNode.attr("type");if(g=="GRID"){var i=this.tbTableName.getValue();if(i==""){FM.Validators.notify(this.tbTableName.$input,"Table Name");return}this.setValue("TableName",i);this.setValue("ViewName",this.tbViewName.getValue());this.setValue("OpenForm",this.tbSelectAction.getValue());this.setValue("HandlerParameters",this.paramsSelect.getValue());this.setValue("CreateForm",this.tbCreateAction.getValue());this.setValue("CreateParameters",this.paramsCreate.getValue());this.setValue("OnRecordOpen",this.cbOnRecordOpen.val());this.setValue("InputFilterField",this.tbInputFilterField.getValue());var c=this.panelSearchMode.getValue();this.setValue("ShowGridFilterPanel",c=="None"?"false":"");this.setValue("SearchMode",c=="ByForm"?c:"");if(c=="ByForm"){this.setValue("SearchStore",$("#cbSearchStore",this.$p).is(":checked")?"true":"");this.setValue("ResultsByRequestOnly",$("#cbResultsByRequestOnly",this.$p).is(":checked")?"true":"")}else{this.setValue("SearchStore","");this.setValue("ResultsByRequestOnly","")}this.setValue("AllowCreate",this.cbAddCreate.is(":checked")?"":"false");this.setValue("Label_NEW",this.tbAddCreate.val());this.setValue("AllowDelete",this.cbAddDelete.is(":checked")?"":"false");this.setValue("Label_DELETE",this.tbAddDelete.val());this.setValue("ShowActionsMenu",this.cbShowActionsMenu.is(":checked")?"":"false");this.setValue("AllowExport",this.cbAddExport.is(":checked")?"true":"");var f=this.linkChart.attr("settings");if(f!=""){f=(this.cbShowChart.is(":checked")?"":"false")+f.substr(f.indexOf("|"))}this.setValue("ChartSettings",f);this.setValue("ShowInfo",this.cbShowInfo.is(":checked")?"true":"");var d=this.tbMoreActions.val();this.setValue("CustomActionsXml",d)}else{if(g!=""){switch(g){case"WORKFLOW":this.setValue("WorkflowName",this.tbWorkflowName.getValue());break;case"FORM":this.setValue("TableName",this.tbForm_TableName.getValue());this.setValue("FormName",this.tbForm_Name.getValue());break;case"SERVERCONTROL":var e=$("#tbControl_Ascx",this.$ctrlStorage).val().trim();if(e==""){e=$("#tbControl_Assembly",this.$ctrlStorage).val().trim()+","+$("#tbControl_FullName",this.$ctrlStorage).val().trim();if(e==","){e=""}}this.mapNode.attr("content",e);this.saveAssignedProperties();break;default:break}}}var b=xml_convertToString(this.storageDoc)}var a='{"profileName":"'+this.profileName+'","groupName":"'+this.groupName+'","folderName":"'+this.folderName+'","xmlData":"'+jsonEncode(b)+'","updateFolder":'+this.updateFolder+',"nodeTitle":"'+jsonEncode(this.nodeTitle)+'","nodeIcon":"'+this.nodeIcon+'","nodeLogo":"'+this.nodeLogo+'","nodeControl":"'+this.nodeControl+'","nodeData":"'+this.nodeData+'"}';ExecuteService(a,FM.Path+"Explorer/ProfileBuilder/SupportService.asmx/SaveNodeProperties",$.proxy(this.onSaveState,this),_fm_onHandlerError);this.$buttonsBar.children("A").attr("disabled",true)},onSaveState:function(a){this.$buttonsBar.children("A").attr("disabled",false);var b=a.d;if(b.Error!=null){AX.Window.alert("Operation Cancelled",b.Error);return}if(window.frameElement){window.frameElement._window.returnValue=true}if(this.closeOnSave){window.setTimeout(this.Close,50)}else{this.$infoLabel.text("Configuration has been saved.").show().css({opacity:1}).animate({opacity:0},2000);this.$nodeInfo.text("")}},Close:function(){var a=window.frameElement?window.frameElement._window:window;a.close()},setLogo:function(a){var b=null;switch(a){case"GRID":b="48_grid.png";break;case"FORM":b="48_form.png";break;case"WORKFLOW":b="48_workflow.png";break;case"[ROOT]":b="48_tree.png";break;case"":b="48_folder.png";break;default:b="48_component.png";break}this.$imgLogo.attr("src","/ASP.Net/FM/Explorer/Images/48/"+b)},getValue:function(c,a){var b=$("set[name='"+c+"']",this.mapNode);return b.length?(b.attr("value")):(a?a:"")},setValue:function(d,c,a){var b=$("set[name='"+d+"']",this.mapNode);if(c!=""){if(b.length==0){b=$(this.storageDoc.createElement("set"));b.attr("name",d);this.mapNode.append(b)}b.attr("value",c)}else{if(b.length){b.remove()}}},setStorageTextValue:function(a,b){this.setValue(a,$(b,this.$ctrlStorage).val().trim())},onSearchMode_changed:function(){var a=$("#panelSearchParams",this.$p);if(this.panelSearchMode.getValue()=="ByForm"){a.css("visibility","visible")}else{a.css("visibility","hidden")}},lable_changed:function(g){var c=this._node;var f=$(c.children()[0]);var b=$(f.contents()[1]);var d=this.$tbLabel.val().trim();if(d!=""&&b.text()!=d){this.nodeTitle=d;b.replaceWith(d);this.updateFolder=true}},folder_checkbox_click:function(b){var a=this.nodeData.split(",");a[0]=this.$cbAllowAutoCount.is(":checked")?"":"false";if(a[0]=="false"){a[1]="false"}this.setNodeData(a.join(","))},setNodeData:function(a){this.nodeData=a;this._node.attr("d",a);this.updateFolder=true},icon_onchange:function(e,d){this.nodeIcon=e;this.nodeLogo=d;this.updateFolder=true;var b=this._node;var f=$(b.children()[0]);var c=$(f.contents()[0]);c.attr("src","/ASP.Net/Images/ico/"+e)},service_handleNode:function(b,a){if(this.folderName==null){return}var a='{"profileName":"'+this.profileName+'","groupName":"'+this.groupName+'","folderName":"'+this.folderName+'","command":"'+b+'","data":"'+a+'"}';ExecuteService(a,FM.Path+"Explorer/ProfileBuilder/SupportService.asmx/HandleNode",$.proxy(this.onHandleComplete,this),_fm_onHandlerError)},onHandleComplete:function(j){var f=j.d;if(f.Error!=null){AX.Window.alert("Operation Cancelled",f.Error);return}var c=f.Value;var g=this.$infoLabel;switch(c){case"ADD":var i=this._node.parent();this.appendNodeUI(i,f.Data);g.text("Folder has been created.");break;case"DELETE":var i=this._node.parent();this.folderName=this._node=this.mapNode=null;var e=i.parent();i.remove();this.checkForChildren(e);if(e.children().length==0){var d=e.parent();e.remove();e=d}g.text("Folder has been deleted.");var h=$("a:first",e);if(!$isNull(h)){this.selectNode(h)}break;case"MOVE-BEFORE":g.text("Folder has been moved.");if(this._dragToNode){var b=this._dragNode.parent();this._dragNode.insertBefore(this._dragToNode);this._dragToNode=null;this.checkForChildren(b)}break;case"MOVE-IN":g.text("Folder has been moved.");if(this._dragToNode){var b=this._dragNode.parent();this.appendNodeUI(this._dragToNode,this._dragNode);g.text("Folder has been moved.");this._dragToNode=null;this.checkForChildren(b)}break}g.show().css({opacity:1}).animate({opacity:0},2000)},appendNodeUI:function(a,d){var c=a.children();var b=c[0];if(c.length==3){ul=$(c[2])}else{ul=$("<ul></ul>");a.append(ul)}ul.append(d).show();b.className="minus"},addNode:function(){if(!this._node){return}var d=$('<div><div style="white-space:nowrap;margin:10px 20px;"><label style="width:90px" class="fm-lbl">Title:</label><input class="fm" style="width:230px;height:22px;" /></div><div style="white-space:nowrap;margin:10px 20px;"><label style="width:90px" class="fm-lbl">Name:</label><input class="fm" style="width:230px;height:22px;" /></div></div>');var b=d.find("INPUT");var c=$(b[0]);var a=$(b[1]);c.blur(function(){if(a.val()==""){a.val(c.val().replace(/ /g,"_"))}});AX.Window.dialog("Add folder",d,function(){var e=a.val().trim();var f=c.val().trim();if(e==""){e=f.replace(/ /g,"_")}if(e==""||f==""){return false}this.service_handleNode("ADD",e+"|"+f);return true},this);c.focus()},deleteNode:function(){if(!this._node||this.folderName==""||this.folderName==null){return}AX.Window.confirm("Delete Folder","Are you sure you want to delete this folder?",function(){this.service_handleNode("DELETE")},this)},startMoving:function(c,b){if(!this._dragElement){this._dragElement=$("<li style='position:absolute;z-Index:1000;background-color:gray;color:white;padding:4px;width:250px;' class='fm-shadow'></li>");this.$tree.append(this._dragElement);this._dragPointer=$("<div style='height:16px;width:16px;background-image:url(Images/arrow.gif);position:absolute;left:0;z-Index:1000;display:none;' />");this.$tree.append(this._dragPointer)}this._dragMoveIn=false;this._dragToNode=null;this._dragNode=b.parent();this._dragElement.html("<a>"+b.html()+"</a><ul></ul>");this.$tree.focus();this.$tree.on({keypress:$.proxy(this.onkeypress,this),mousemove:$.proxy(this.treeOnMove,this),mouseup:$.proxy(this.treeOnMoveEnd,this),mouseover:$.proxy(this.treeOnMoveOver,this)});this._dragNode.css("opacity",0.2);this._dragNode.on("mouseover",$.proxy(this.dragNodeOnMoveOver,this));this.treeOnMove(c);this._dragElement.css("display","")},onkeypress:function(a){if(a.keyCode==27){this._dragToNode=null;this.treeOnMoveEnd()}},treeOnMove:function(b){var a=b.pageX;var c=b.pageY;this._dragElement.css({left:"2px",top:(c-15)+"px"})},dragNodeOnMoveOver:function(a){a.stopPropagation();a.preventDefault();var b=$(this._dragElement.children()[1]);b.text("");this._dragPointer.css("display","none");this._dragToNode=null},treeOnMoveOver:function(f){var i=this._dragElement;var c=f.target;if(c.tagName=="IMG"){c=c.parentNode}if(c.tagName=="LABEL"){c=c.parentNode}if(c.tagName=="A"){c=c.parentNode}if(c.tagName=="LI"){var g=$(c);var l=$(g.children()[1]).text();if(l=="Root"){this.dragNodeOnMoveOver(f)}else{var b=g.position();var h=b.top-9;var j=(b.left-2);var k=$(this._dragElement.children()[1]);if(f.shiftKey){this._dragMoveIn=true;h+=15;j-=14;k.text("Move into "+l)}else{this._dragMoveIn=false;k.text("Insert before "+l)}this._dragPointer.css({left:j+"px",top:h+"px",display:""});this._dragToNode=g}}else{if(c.tagName=="SPAN"&&c.className=="plus"){c.className="minus";var d=$(c).next().next();d.css({display:"block"})}}},treeOnMoveEnd:function(b){this.$tree.off("keypress").off("mouseup").off("mousemove").off("mouseover");this._dragElement.css("display","none");this._dragPointer.css("display","none");this._dragNode.off("mouseover");this._dragNode.css("opacity",1);if(this._dragToNode){var a=$(this._dragToNode.children()[1]).attr("n");this.service_handleNode(this._dragMoveIn?"MOVE-IN":"MOVE-BEFORE",a)}},checkForChildren:function(b){if(b.children().length==0){var a=b.parent().children()[0];a.className="";b.css("display","none")}},openMenuBuilder:function(){var a=this.tbMoreActions.val();if(!this.menuBuilder){wnd=AX.Window.createPopupWindow("Menu Designer Dialog",720,450,false);var b=this.tbMoreActions;var c=$createDelegate(function(d){b.val(d);this.Save(false)},this);wnd.show();wnd.loadASCX(FM.Path+"Explorer/ProfileBuilder/Controls/GridMenuBuilder.ascx",[FM.Path+"Explorer/ProfileBuilder/Controls/FM.GridMenuBuilder.js"],$createDelegate(function(){this.menuBuilder=new FM.GridMenuBuilder(wnd,c);this.menuBuilder.load(a)},this))}else{this.menuBuilder.load(a);this.menuBuilder._window.show()}},openProperties:function(){var a=AX.Window.createPopupWindow("Profile Properties",500,480,false,true);a.loadASCX(RMC.Path+"ProfileBuilder/properties.ascx",null,$createDelegate(function(){this.profileProperties=new RMC.ProfileProperties(this,a);this.profileProperties.loadState()},this));a.show()},openCreateDialog:function(){FM.ProgressBar.Show("Creating Profile",true);var a='{"profileName":"'+this.profileName+'","groupName":"'+this.groupName+'","selectedRole":"'+(this.data.sr||"")+'"}';ExecuteService(a,FM.Path+"Explorer/ProfileBuilder/SupportService.asmx/CreateProfile",$.proxy(this.onCreateProfile,this),_fm_onHandlerError)},onCreateProfile:function(a){FM.ProgressBar.Hide();var b=a.d;if(b.Error){AX.Window.alert("Profile Builder - Error",b.Error);return}this.groupName=b.Data;this._window.setHeader(this.profileName+" / "+this.groupName+" - Profile Builder");this.init();AX.Window.alert("Profile Builder","The profile for the role <b>"+this.groupName+"</b> has been successfuly created.")},folder_more_properties:function(){var a=this;RMC_OpenOrCreate("RMC.ProfileFolderProperties","Folder attributes",400,300,FM.Path+"Explorer/ProfileBuilder/Controls/FolderProperties.ascx",null,function(b){b.component=new RMC.ProfileFolderProperties(b)},function(b){b.component.LoadState(a)},null)},chart_settings:function(){var b=this.linkChart;var a=this.tbTableName.getValue();RMC_OpenOrCreate("RMC.GridChartSettings","Grid chart settings",500,250,FM.Path+"Explorer/ProfileBuilder/Controls/GridChartSettings.ascx",null,function(c){c.component=new RMC.GridChartSettings(c)},function(c){c.component.LoadState(b,a)},null)},change_content_click:function(a){if(this.folderName==""){return}window.Runtime_Library.createObject("FM.AddContentWindow",[FM.Path+"Explorer/ProfileBuilder/Controls/FM.AddContentWindow.js"],null,this)},tree_btn_click:function(a){switch(_fm_getCommand(a)){case"add":this.addNode();break;case"delete":this.deleteNode();break}},btn_click:function(a){switch(_fm_getCommand(a)){case"save":this.Save(false);break;case"saveX":this.Save(true);break;case"X":this.Close();break;case"create":this.openCreateDialog();break;case"properties":this.openProperties();break}}};