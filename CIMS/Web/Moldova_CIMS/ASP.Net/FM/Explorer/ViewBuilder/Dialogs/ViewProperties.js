RMC.VB_ViewProperties=function(a){this._window=a;this.$p=a.$content;this.tabBar=new FM.Tabbar($("div.fm-dlg-tabbar",this.$p));$("div.fm-dlg-buttons",this.$p).addHandler("click",this.btn_click,this);this.$tab_hdr_lookup=$("span#tab_hdr_lookup",this.$p);this.initialize()};RMC.VB_ViewProperties.prototype={LoadState:function(b){this._window.show();this._vb=b;this.isLookup=(b._mode=="LOOKUP");var d=this._vb.$xnview;this.$tab_hdr_lookup.toggle(this.isLookup);this.lookupPanel1.toggle(this.isLookup);this.viewName.val(b.viewName);this.viewTitle.val(d.find("header").attr("title"));this.viewDesc.val(d.find("description").attr("title"));this.printHeader.val(d.find("printheader").attr("title"));this.chSelect.attr("checked",d.attr("check")=="true");var c=d.attr("icon")=="true";if(c){this.viewicon_reload()}this.chIcon.attr("checked",c);this.panelIconSettings.toggle(c);var a=d.find("row");this.tb_recordtypefield.parentValue=b.tableName;this.tb_recordtypefield.setValue(a.attr("recordtypefield")||"");this.tb_imagetype.setValue(a.attr("imagetype")||"");var e=d.attr("mode")||"";this.displayMode.setValue(e);this.$linkGrouping.toggle(e=="Grouping");this.$linkHierarchy.toggle(e=="Hierarchy");var f=d.attr("expandMode");this.expandMode.setValue(f);this.$linkMasterDetail.toggle(f=="MasterDetail");this.$rbMasterDetail.toggle(!this.isLookup);this.$trRowActions.toggle(!this.isLookup);if(!this.isLookup){this.actions_load(d)}if(this.isLookup){this.Lookup_LoadState(d)}},actions_load:function(f){var a=f.find("rowactions");var e=false;var g=false;if(!$isNull(a)){var d=a.children();for(var b=0;b<d.length;b++){var c=d[b].getAttribute("handler");if(c=="EDIT"){e=true}else{if(c=="DELETE"){g=true}}}}this.$cb_aOpen.prop("checked",e);this.$cb_aDelete.prop("checked",g)},Lookup_LoadState:function(g){var e=this.$p;this.dialogTitle.val(g.find("dialogHeader").attr("title"));this.dialogDesc.val(g.find("dialogDescription").attr("title"));if(!this.div_property_window){this.div_property_window=new FM.WindowParameters($("#div_property_window",e));this.div_create_window=new FM.WindowParameters($("#div_create_window",e));this.div_view_window=new FM.WindowParameters($("#div_view_window",e));this.div_view_ro_window=new FM.WindowParameters($("#div_view_ro_window",e))}var b=$("handlers",g);var f=$("property",b);var d=$("create",b);var a=$("view",b);var c=$("view_ro",b);$("#cb_property",e).prop("checked",f.attr("enabled")=="true");$("#tb_property",e).val(f.text());this.div_property_window.setValue(f.attr("window"));$("#tb_property_text",e).val(f.attr("title")||"Property");$("#cb_create",e).prop("checked",d.attr("enabled")=="true");$("#tb_create",e).val(d.text());this.div_create_window.setValue(d.attr("window"));$("#tb_create_text",e).val(d.attr("title")||"Create");$("#tb_view",e).val(a.text());this.div_view_window.setValue(a.attr("window"));$("#tb_view_ro",e).val(c.text());this.div_view_ro_window.setValue(c.attr("window"))},SaveState:function(){var c=this._vb.xmlDoc;var b=this._vb.$xnview;xml_setNodeAttr(c,b,"header","title",this.viewTitle.val().trim(),true);xml_setNodeAttr(c,b,"description","title",this.viewDesc.val().trim(),true);xml_setNodeAttr(c,b,"printheader","title",this.printHeader.val().trim(),false);b.attr("check",this.chSelect.is(":checked"));b.attr("icon",this.chIcon.is(":checked"));var a=b.find("row");xml_updateAttr(a,"recordtypefield",this.tb_recordtypefield.getValue());xml_updateAttr(a,"imagetype",this.tb_imagetype.getValue());var d=this.displayMode.getValue();xml_updateAttr(b,"mode",d);var e=this.expandMode.getValue();xml_updateAttr(b,"expandMode",e);if(!this.isLookup){this.actions_save(c,b)}if(this.isLookup){this.Lookup_SaveState(c,b)}},Lookup_SaveState:function(h,a){var b=this.$p;xml_setNodeAttr(h,a,"dialogHeader","title",this.dialogTitle.val().trim(),false);xml_setNodeAttr(h,a,"dialogDescription","title",this.dialogDesc.val().trim(),false);var i=$("handlers",a);var d=!$isNull(i);if(!d){i=xml_createNode(h,"handlers")}var g=this.updateHandlerNode(h,i,"property",this.div_property_window,true,"Property","FORM:default/READONLY");var f=this.updateHandlerNode(h,i,"create",this.div_create_window,true,"Create","FORM:create");var e=this.updateHandlerNode(h,i,"view",this.div_view_window,false,null);var c=this.updateHandlerNode(h,i,"view_ro",this.div_view_ro_window,false,null);if(!g&&!f&&!e&&!c){i.remove()}else{if(!d){a.append(i)}}},actions_save:function(f,e){var a=e.find("rowactions");var b=this.$cb_aOpen.prop("checked");var g=this.$cb_aDelete.prop("checked");var c=!$isNull(a);if(!b&&!g){if(c){a.remove()}return}if(!c){a=xml_appendNode(f,e,"rowactions")}else{a.empty()}if(b){var d=xml_appendNode(f,a,"item");d.attr("handler","EDIT").attr("title","Open")}if(g){var d=xml_appendNode(f,a,"item");d.attr("handler","DELETE").attr("title","Delete")}},updateHandlerNode:function(m,n,b,g,d,l,k){var i=this.$p;var a=false;var f=false;var c=$(b,n);var j=!$isNull(c);if(!j){c=xml_createNode(m,b)}if(d){f=$("#cb_"+b,i).is(":checked");xml_updateAttr(c,"enabled",""+f);if(f){a=true}}xml_updateAttr(c,"window",g.getValue());var e=$("#tb_"+b,i).val().trim();if(e==""&&f){e=k}c.text(e);if(e!=""){a=true}if(l!=null){var o=$("#tb_"+b+"_text",i).val().trim();if(o==l){o=""}xml_updateAttr(c,"title",o);if(o!=""){a=true}}if((d&&!f&&e==k)||e==""){a=false}if(a){if(!j){n.append(c)}}else{c.remove()}return a},viewicon_onselect:function(a){if(a){var b='{"tableName":"'+this._vb.tableName+'","viewName":"'+this._vb.viewName+'","mode":"'+this._vb._mode+'","ico_name":"'+a+'"}';ExecuteService(b,RMC.Path+"ViewBuilder/SupportService.asmx/CopyIcon",$createDelegate(this.viewicon_reload,this))}},viewicon_reload:function(){this.imgIcon.setValue("/FM/_DATA/"+this._vb.tableName+"/_"+(this.isLookup?"lookup":"")+"views/"+this._vb.viewName+"/ico.png")},masterdetail_customize:function(){var a=this._vb;RMC_OpenOrCreate("RMC.VB_MasterDetail","Master Detail Properties",450,420,RMC.Path+"ViewBuilder/Dialogs/MasterDetail.ascx",null,function(b){b.component=new RMC.VB_MasterDetail(b)},function(b){b.component.LoadState(a)},null)},grouping_customize:function(){var a=this._vb;RMC_OpenOrCreate("RMC.VB_Grouping","Grouping Properties",450,300,RMC.Path+"ViewBuilder/Dialogs/Grouping.ascx",null,function(b){b.component=new RMC.VB_Grouping(b)},function(b){b.component.LoadState(a)},null)},hierarchy_customize:function(){var a=this._vb;RMC_OpenOrCreate("RMC.VB_Hierarchy","Hierarchy Properties",500,250,RMC.Path+"ViewBuilder/Dialogs/Hierarchy.ascx",null,function(b){b.component=new RMC.VB_Hierarchy(b)},function(b){b.component.LoadState(a)},null)},btn_click:function(a){switch(_fm_getCommand(a)){case"OK":this.SaveState();this._window.close();break;case"X":this._window.close();break}},initialize:function(){this.viewName=$("#viewName",this.$p);this.viewTitle=$("#viewTitle",this.$p);this.viewDesc=$("#viewDesc",this.$p);this.printHeader=$("#printHeader",this.$p);this.lookupPanel1=$("#lookupPanel1",this.$p);this.dialogTitle=$("#dialogTitle",this.$p);this.dialogDesc=$("#dialogDesc",this.$p);this.chSelect=$("#chSelect",this.$p);this.chIcon=$("#chIcon",this.$p);this.panelIconSettings=$("#panelIconSettings",this.$p);this.imgIcon=new FM.ImageControl($("#imgIcon",this.$p),null,"change icon");this.imgIcon.relPath="";this.imgIcon.onchange_callback=$createDelegate(this.viewicon_onselect,this);this.chIcon.addHandler("change",function(){this.panelIconSettings.toggle(this.chIcon.is(":checked"))},this);this.tb_recordtypefield=new FM.LookupTextControl($("#tb_recordtypefield",this.$p));this.tb_imagetype=new FM.LookupTextControl($("#tb_imagetype",this.$p));this.displayMode=new FM.RadioGroup($("#displayMode",this.$p));this.expandMode=new FM.RadioGroup($("#expandMode",this.$p));this.$linkMasterDetail=$("#linkMasterDetail",this.$p);this.$linkMasterDetail.addHandler("click",this.masterdetail_customize,this);this.$linkGrouping=$("#linkGrouping",this.$p);this.$linkGrouping.addHandler("click",this.grouping_customize,this);this.$linkHierarchy=$("#linkHierarchy",this.$p);this.$linkHierarchy.addHandler("click",this.hierarchy_customize,this);this.displayMode.change(function(){var a=this.displayMode.getValue();this.$linkGrouping.toggle(a=="Grouping");this.$linkHierarchy.toggle(a=="Hierarchy")},this);this.expandMode.change(function(){this.$linkMasterDetail.toggle(this.expandMode.getValue()=="MasterDetail")},this);this.$rbMasterDetail=$("#rbMasterDetail",this.$p);this.$trRowActions=$("#trRowActions",this.$p);this.$cb_aOpen=$("#cb_aOpen",this.$p);this.$cb_aDelete=$("#cb_aDelete",this.$p)},};