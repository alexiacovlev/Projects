FM.PicklistAdminDialog=function(d,b,a){this.control=d;this.$ui=d.$o;this.onselect=b;this.type=this.control.get("type");this.image=this.control.get("image");this.filterType=this.control.get("filter");this.parentName=null;this.$popup=$("<div class='fm_popup' style='border:0;'><div class='fm_list'></div></div>");this.$popup.addHandler("mousedown",this.panel_click,this);this._popup=this.$popup[0];this.$list=$(this._popup.firstChild);this._list=new FM.ListControl(this.$list);this._list.dblclick($createDelegate(this.ondblclick,this));this.$list.addHandler("blur",this.Close,this);this.$list.addHandler("click",this.ondblclick,this);this.is_static=this.$ui.attr("options")!="";if(this.is_static){this.loadFromString(this.$ui.attr("options"))}this.control.$btn.addHandler("mousedown",this.btn_mousedown,this)};FM.PicklistAdminDialog.prototype={Show:function(c){if(this.isOpened){return}this.isOpened=true;this.parentName=c;if(!this.is_static){this.reload()}var b=this.$ui.width()-2;if(b<100){b=100}var e=this.$ui.offset();var a=e.left;var d=e.top+19;this.$popup.css({width:b+"px",left:a+"px",top:d+"px","z-index":5000});document.body.appendChild(this._popup);this.$list.focus()},Close:function(){if(!this.isOpened){return}this.isOpened=false;document.body.removeChild(this._popup)},reload:function(){this.$list.empty();ExecuteService('{"type":"'+this.type+'","parentName":"'+this.parentName+'"}',FM.Path+"Explorer/Dialogs/DialogService.asmx/GetLookupDialogItems",$.proxy(this.onLoadItems,this),_fm_onHandlerError)},onLoadItems:function(a){this.itemList=a.d;this.redraw(this.itemList)},loadFromString:function(a){var b=a.split(",");this.redraw(b)},redraw:function(c){var b="";if(c.length>0){for(var a=0;a<c.length;a++){oi=this.itemList[a];v=oi;text=oi;b+='<a value="'+v+'">'+text+"</a>"}}else{b="<a value=''>no options</a>"}this._list.loadHTML(b)},btn_mousedown:function(a){if(this.isOpened){a.preventDefault()}},ondblclick:function(){var a=this._list.getSelAttr("value");if(a){this.onselect(a)}this.Close()},};