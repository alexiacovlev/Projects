FM.LookupAdminDialog=function(d,b,a){this.control=d;this.onselect=b;this.type=this.control.get("type");this.image=this.control.get("image");this.hasImage=(this.image!="");this.filterType=this.control.get("filter");this.sep=this.control.get("separator");this.hasText=(this.sep!=null&&this.sep!="");this.parentName=null};FM.LookupAdminDialog.prototype={Show:function(d){var c=this._window=AX.Window.createPopupWindow(this.control.get("wndTitle"),0,0,false,true);c.parseSize(this.control.get("wndSize"));var e=(this.filterType=="LIST")?"You can quick filter items using filter box below.<br/>Filter uses item's prefix to group by.":"Type the object name you are looking for in the Find box<br /> and click Go, then, select the item you want and click OK.";var b="<div class='fm-lookup-header'><div style='margin:5px 0px 3px 5px;height:30px;'><img style='float:left;' src='/ASP.Net/FM/Common/Images/32_lookup_ico.png' /><div style='font-size:8pt;padding:3px 0 0 10px;display:inline-block;'>"+e+"</div></div></div><div style='left:0px;top:68px;right:0px;bottom:34px;position:absolute;overflow-y:scroll;' class='fm_list'></div><div style='left:3px;bottom:8px;position:absolute;'></div><div style='right:3px;bottom:3px;position:absolute;'>"+FM.DialogUtils.buildButton("None","NONE",55,"",false)+FM.DialogUtils.buildButton("OK","OK",55,"ok.png",true)+FM.DialogUtils.buildButton("Close","X",55,"16_close.png",false)+"</div>";c.loadHTML(b);var a=c.$content.children();this.$header=$(a[0]);this._list=new FM.ListControl($(a[1]));this._list.dblclick($createDelegate(this.ondblclick,this));this.$info=$(a[2]);this.$buttons=$(a[3]);this.$buttons.addHandler("click",this.btn_onclick,this);c.show();this.parentName=d;this.reload()},reload:function(){this.filterPrefix="";this.searchText="";ExecuteService('{"type":"'+this.type+'","parentName":"'+this.parentName+'"}',FM.Path+"Explorer/Dialogs/DialogService.asmx/GetLookupDialogItems",$.proxy(this.onLoadItems,this),_fm_onHandlerError)},onLoadItems:function(a){this.itemList=a.d;this.count=this.itemList.length;if(this.filterType=="LIST"){this.addFilterSelector()}else{this.addSearchBox()}this.redraw()},redraw:function(){var e="";var f,g,c;var b=this.itemList.length;for(var d=0;d<this.itemList.length;d++){f=this.itemList[d];c=f;g=c;if(g==""){g="&nbsp;"}if(this.hasText){var a=c.split(this.sep);c=a[0];g=a[1]}if(this.filterPrefix!=""){pi=c.indexOf("_");p=(pi!=-1)?c.substr(0,pi):c;if(p!=this.filterPrefix){continue}}else{if(this.searchText!=""){if(c.indexOf(this.searchText)==-1){continue}}}e+='<a value="'+c+'">&nbsp;';if(this.hasImage){e+="<img src='"+this.image+"'/>&nbsp;"}e+=g+"</a>"}this.$info.text("Total: "+b+" items.");this._list.loadHTML(e)},ondblclick:function(){var a=this._list.getSelAttr("value");if(a){this.onselect(a);this._window.close()}},btn_onclick:function(b){switch(_fm_getCommand(b)){case"OK":var a=this._list.getSelAttr("value");if(!a){return}this.onselect(a);break;case"NONE":this.onselect("");break}this._window.close()},addSearchBox:function(){var a="<table style='position:absolute;top:40px;width:100%'><tr><td style='width:60px;padding-left:10px;'>Find:</td><td><input class='fm'/></td><td style='width:50px;'><a style='width:50px;' class='fm-btn-flat'>Go</a></td></tr></table>";var b=$(a);this._list.$o.parent().append(b);this.$searchbox=$("input",b);$("A",b).addHandler("click",this.onsearch,this);this.$searchbox.addHandler("keypress",this.onsearchtype,this);this.$searchbox.focus()},onsearchtype:function(a){if(a.keyCode==13){this.onsearch()}},onsearch:function(){this.searchText=this.$searchbox.val().trim();this.redraw()},addFilterSelector:function(){var a=$('<div style="position:absolute;top:42px;left:12px;"></div>');this._list.$o.parent().append(a);var d="<select style='position:relative;left:30px;width:200px'>";d+='<option value=""> - Show All Records - </option>';var b,h,g;var e=0;var f=null;for(var c=0;c<this.itemList.length;c++){b=this.itemList[c];h=b.indexOf("_");g=(h!=-1)?b.substr(0,h):b;if(f==null){f=g}if(f!=g){if(e>1){d+='<option value="'+f+'">'+f+" ... "+e+"</option>"}f=g;e=0}e+=1}if(e>1){d+='<option value="'+f+'">'+f+" ... "+e+"</option>"}d+="</select>";this.$groupDDL=$(d);a.append("<label class='n' style='position:relative;'>Filter by prefix</label>");a.append(this.$groupDDL);this.$groupDDL.change($createDelegate(this.onfilter,this))},onfilter:function(){this.filterPrefix=this.$groupDDL.val();this.redraw()}};