// RecordsManagement Admin Client Script Library
// Alfa-XP,	Michael	Isipciuc,	2012.
//
FM.DialogUtils={buildButton:function(e,d,a,c,b){return'<a cmd="'+d+'" class="fm-btn" style="margin-left:6px;width:'+a+"px;"+(b?"font-weight:bold":"")+'">'+(c!=""?('<img src="'+window.FM.CommonImagePath+c+'" />'):"")+e+"</a>"},scrollBottom:function(a){a.animate({scrollTop:a.prop("scrollHeight")},500)},set_loading:function(a){a.empty().append("<img src='"+FM.Path+"Common/Images/loading_200_10.gif' style='width:200px;height:10px;display:block;margin-top:30%;margin-left:auto;margin-right:auto;'/>")}};FM.Validators={notify:function(a,f,e,c,b){if(!e){e="Please, enter value for "+f}var d=a[0]._tooltip;if(!d){d=new FM.Tooltip(a.parent(),5+(c||0),-25+(b||0));a[0]._tooltip=d}d.Show(e,true);a.focus()},alert:function(a,c,b){if(!b){b="Please, enter value for "+c}AX.Window.alert("",b,function(){a.focus()})},checkName:function(a){var b=new RegExp(/^[a-z][a-z\d\_]*$/i);return b.test(a)}};FM.RadioGroup=function(a){this.items=$("input",a);this.setValue=function(e,c){if(!e){e=c||""}var d;for(var b=0;b<this.items.length;b++){d=this.items[b];if(d.value==e){$(d).attr("checked","checked");break}}};this.getValue=function(d){var e;var b="";for(var c=0;c<this.items.length;c++){e=this.items[c];if($(e).is(":checked")){b=e.value;break}}return(b!=d)?b:""};this.change=function(b,c){this.items.change($createDelegate(b,c))}};FM.Tabbar=function(a){this.$tabBar=a;this.$tabPanel=a.next();this._index=0;this.onselect=null;this.tabs_click=function(d){d.preventDefault();var b=this.$tabPanel.children();var f=d.target;if(f.tagName=="SPAN"){var c=$(f);this.$tabBar.children().each(function(){$(this).removeClass("tabOn")});c.addClass("tabOn");this._index=c.index();b.each(function(){this.style.display="none"});b[this._index].style.display="block";if(this.onselect){this.onselect(this._index)}}},this.select=function(d){if(this._index==d){return}this._index=d;var c=this.$tabBar.children();c.each(function(){$(this).removeClass("tabOn")});$(c[d]).addClass("tabOn");var b=this.$tabPanel.children();b.each(function(){this.style.display="none"});b[d].style.display="block"},this.$tabBar.addHandler("mouseup",this.tabs_click,this)};FM.LookupTextControl=function(a,b,c){this.$o=a;this.$input=$("INPUT",a);this.$btn=$("IMG",a);if(c){this.$btn.addHandler("click",c,this)}else{this.$btn.addHandler("click",this.onclick,this)}this.$btn.css("cursor","pointer");this.onselect=null;this.parentControl=b;this.parentValue=""};FM.LookupTextControl.prototype={setValue:function(a){this.$input[0].value=a||""},getValue:function(){return this.$input[0].value.trim()},onSelectValue:function(a){this.setValue(a);if(this.onselect){this.onselect(a)}},get:function(a){return this.$o.attr(a)},onclick:function(){this.isPicklist=(this.$o.attr("mode")=="Picklist");var d=this;if(this.parentControl){this.parentValue=this.parentControl.getValue();if(!this.parentValue){AX.Window.alert("","You should define value for related control first");return}}var c=this.parentValue;var e=d._dialog;if(!e){var b=$createDelegate(this.onSelectValue,this);if(this.isPicklist){var a=function(){d._dialog=new FM.PicklistAdminDialog(d,b);d._dialog.Show(c)};Runtime_ResourceLoader.LoadResources([FM.Path+"Explorer/Dialogs/FM.PicklistAdminDialog.js"],a)}else{var a=function(){d._dialog=new FM.LookupAdminDialog(d,b);d._dialog.Show(c)};Runtime_ResourceLoader.LoadResources([FM.Path+"Explorer/Dialogs/FM.LookupAdminDialog.js"],a)}}else{if(this.isPicklist&&e.isOpened){e.Close(c)}else{e.Show(c)}}}};FM.ListControl=function(a,b){this.$o=a;this.reset=function(){if(this.sel){this.sel.className="";this.sel=null}};this.loadHTML=function(c){this.$o.empty().html(c)};this.getSelAttr=function(c){if(!this.sel){return null}return $(this.sel).attr(c)};this.onclick=function(c){var d=c.target;if(d.tagName=="IMG"||d.tagName=="LABEL"){d=d.parentNode}if(d.tagName!="A"){return}this.reset();this.sel=d;this.sel.className="sel";if(b){b(d)}};this.dblclick=function(c){this.$o.on("dblclick",c)};this.$o.addHandler("click",this.onclick,this)};FM.ResTitle=function(a){this.$tb=a;this.$lang=a.next();this.isMulti=(this.$lang.length==1);this.restitle_loaded=false;if(this.isMulti){this.initMulti=function(){this.tb_mas=new Array();var b=this.$lang[0].options;this.tb_mas.push(a[0]);var f=this.$tb.parent();for(var c=1;c<b.length;c++){var e=b[c].value;var d=a.clone();d.attr("lcid",e).val("").hide();f.append(d);this.tb_mas.push(d[0])}this._current=0};this.loadResValues=function(){this.restitle_loaded=true;for(var b=1;b<this.tb_mas.length;b++){var e=this.tb_mas[b].getAttribute("lcid");var d="";if(this.restitle!=""){var f=this.restitle.indexOf(e+":");if(f!=-1){var c=this.restitle.indexOf("|",f+5);d=(c!=-1)?this.restitle.substr(f+5,c-f-5):this.restitle.substr(f+5)}}this.tb_mas[b].value=d}};this.onchange=function(){if(!this.tb_mas){this.initMulti()}if(!this.restitle_loaded){this.loadResValues()}var b=this.$lang[0].selectedIndex;if(this._current!=b){this.tb_mas[this._current].style.display="none";this._current=b;this.tb_mas[this._current].style.display=""}};this.$lang.addHandler("change",this.onchange,this)}this.setValue=function(b){this.$tb.val(b)};this.getValue=function(){return this.$tb.val().trim()};this.setResValue=function(b){this.restitle=b||"";if(this.isMulti&&this.tb_mas){this.restitle_loaded=false;this.$tb.show();this.$lang[0].selectedIndex=this._current=0;for(var c=1;c<this.tb_mas.length;c++){$(this.tb_mas[c]).hide().val("")}}};this.getResValue=function(){if(!this.isMulti||!this.tb_mas){return this.restitle}var e="";for(var d=1;d<this.tb_mas.length;d++){var b=this.tb_mas[d];var c=b.value.trim();if(c!=""){if(e.length>0){e+="|"}e+=b.getAttribute("lcid")+":"+c}}return e}};FM.WindowParameters=function(a){this.$o=a;this.$o.attr("title","width,height,maximize(true)");this.$a=$("<a class='fm' style='cursor:pointer;margin-left:3px;line-height:19px;'>&nbsp;</a>");this.$input=$("<input class='fm' style='display:none;width:90px;font-style:italic'/>");this.$o.append("<label class='comment'>Window size: </label>").append(this.$a).append(this.$input);this.$a.addHandler("click",this.onclick,this);this.$input.addHandler("blur",this.onblur,this);this.defSize="900,550"};FM.WindowParameters.prototype={setValue:function(a){if(!a||a==",,"){a=this.defSize}this.val=this.$input[0].value=a;this.$a.text(a)},getValue:function(){return(this.val!=this.defSize)?this.val:""},onclick:function(){this.$a.hide();this.$input.show().focus()},onblur:function(){var d=this.$input[0].value.trim();if(d!=""){var c=d.split(",");if(c.length<2){c=this.defSize.split(",")}var a=parseInt(c[0]);var b=parseInt(c[1]);if(isNaN(a)||isNaN(b)){d=this.defSize}else{d=a+","+b+((c.length==3&&c[2]=="true")?",true":"")}}this.val=this.$input[0].value=d;this.$input.hide();this.$a.text(d).show()}};FM.ActionSelectorHandler=function(){var c=this;var d=FM.ActionSelectorHandler._dialog;if(!d){var b=$createDelegate(this.setValue,this);var a=function(){d=FM.ActionSelectorHandler._dialog=new FM.ActionSelectorDialog();d.Show(c)};Runtime_ResourceLoader.LoadResources([FM.Path+"Explorer/Dialogs/FM.ActionSelectorDialog.js"],a)}else{d.Show(c)}};FM.ImageControl=function(b,a,c){this.relPath="/ASP.Net/Images/ico/";this.$o=b;this.img=$("<img width='16' height='16' style='vertical-align:bottom'/>");b.append(this.img);this.btn=$("<a class='fm' style='margin-left:5px;line-height:15px;'>"+(c||"Change")+"</a>");b.append(this.btn);this.btn.addHandler("click",this.onclick,this);this.logo=$("<i class='ax-ico' style='margin-left:30px;font-size:1.3em'>&#xa0c2</a>");b.append(this.logo);this.btn2=$("<a class='fm' style='margin-left:5px;'></a>");b.append(this.btn2);this.btn2.addHandler("click",this.onclick2,this);this.onchange_callback=null;this.$tb=a;if(a){a.change($.proxy(this.tb_onchange,this))}};FM.ImageControl.Gallery=null;FM.ImageControl.prototype={onclick:function(){var a=$.proxy(this.onselect,this);if(!FM.ImageControl.Gallery){window.Runtime_Library.createObject("FM.ImageGalleryDialog",[FM.Path+"Explorer/Dialogs/FM.ImageGalleryDialog.js"],function(b){FM.ImageControl.Gallery=b;FM.ImageControl.Gallery.Show(a)})}else{FM.ImageControl.Gallery.Show(a)}},tb_onchange:function(){var a=this.$tb.val().trim();this.setValue(a,null);if(this.onchange_callback){this.onchange_callback(this.value,this.logovalue)}},onselect:function(a){this.setValue(a,null);if(this.onchange_callback){this.onchange_callback(this.value,this.logovalue)}},onclick2:function(){var a=$createDelegate(this.onLogoSelected,this);if(!window.parent.AX.IconGalleryDialog){window.parent.Runtime_ResourceLoader.LoadResources(["/ASP.Net/WebAdmin/ThemeManager/AX.IconGalleryDialog.js"],function(){var b=new window.parent.AX.IconGalleryDialog();b.onSelect=a})}else{window.parent.AX.IconGalleryDialog.Current.onSelect=a;window.parent.AX.IconGalleryDialog.Current.Show()}},onLogoSelected:function(a){this.setValue(null,a);if(this.onchange_callback){this.onchange_callback(this.value,this.logovalue)}},setValue:function(a,b){if(a!=null){this.value=a}if(b!=null){this.logovalue=b}this.img.attr("src",this.relPath+this.value);this.logo.html(this.logovalue?("&#x"+this.logovalue):"&#xa0c2");this.btn2.text(this.logovalue?"change logo":"add logo");if(this.$tb){this.$tb.val(this.value)}},getValue:function(){return this.value},getLogo:function(){return this.logovalue},getSrc:function(){if(this.value==""){return""}return this.relPath+this.value}};