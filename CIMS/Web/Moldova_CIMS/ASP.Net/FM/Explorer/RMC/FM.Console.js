// Records Management Console Client Script Library
// Alfa-XP, Michael Isipciuc, 2012.
//
FM.Console=function(e,a,d,c){var b=e;this.$listTables=$("#listTables",b);this.$listTables.load(FM.Path+"Explorer/RMC/TableGroupsSource.aspx",$createDelegate(this.init,this));this.$listTables.addHandler("click",this.onclick,this);$("#_toolbar",b).addHandler("click",this.toolbar_click,this);this.$filter=$("#filter",b);this.$filter.addHandler("change",this.filter_change,this);this.$filter.addHandler("keypress",this.filter_keypress,this);this.selected_row=null};FM.Console.prototype={init:function(){this.listHtml=this.$listTables.html()},filter_change:function(){var a=this.$filter.val().trim();if(a){this.$listTables.load(FM.Path+"Explorer/RMC/TableListDataSource.aspx?filter="+a)}else{this.$listTables.html(this.listHtml)}},filter_keypress:function(a){if(a.keyCode==13){this.filter_change()}},getSelectedName:function(){if(!this.selected_row){AX.Window.alert("","Please, select the table from the list.")}return this.selected_row?this.selected_row.getAttribute("n"):""},onclick:function(c){var a=null;var d=c.target;if(d.tagName=="IMG"||d.tagName=="LABEL"){d=d.parentNode}if(d.tagName=="DIV"){d=d.parentNode}if(d.tagName=="TD"){d=d.parentNode}if(d.tagName=="TR"){a=d.getAttribute("n");if(a!=null){if(this.selected_row==d){d.className="sel";this.selected_row=d;RMC_OpenTableSettings(a)}else{if(this.selected_row){this.selected_row.className=""}d.className="sel";this.selected_row=d}}else{var b=d.getAttribute("group");if(b){d.removeAttribute("group");$(d.firstChild).load(FM.Path+"Explorer/RMC/TableListDataSource.aspx?group="+b)}else{$(d.firstChild.firstChild.nextSibling).toggle()}}}},toolbar_click:function(c){switch(_fm_getCommand(c)){case"add":var b=AX.Window.createPopupWindow("Create New Table",450,210,false,true);b.loadASCX(FM.Path+"Explorer/RMC/TableMenu/Create.ascx",null,function(){new RMC.CreateTableDialog(b)});b.show();break;case"edit":RMC_OpenTableSettings(this.getSelectedName());break;case"forms":var a=this.getSelectedName();if(!a){return}var b=AX.Window.create(null,"Table Entities",700,457);b.loadASCX(FM.Path+"Explorer/RMC/TableMenu/Entities.ascx",null,function(){new RMC.EntitiesDialog(b,a)});b.show();break;case"db_stat":var b=AX.Window.create(null,"Database Usage Statistics",850,550);b.loadURL(FM.Path+"Explorer/Diagnostics/stats.aspx",null,true);b.show();break;case"diag":var b=AX.Window.create(null,"Records Management Diagnostics Tool",1100,800);b.loadURL(FM.Path+"Explorer/Diagnostics/main.aspx",null,true);b.show();break}}};RMC_OpenTableSettings=function(a,c){if(!a){return}var b=window.parent.FM.TableSettingsDialog;if(!b){b=window.parent.FM.TableSettingsDialog=new window.parent.AX.Window(false);b.setSize(850,640)}b.refresh_callback=c;b.loadURL(FM.Path+"Explorer/#TableBuilder/t="+a);b.show()};