RMC.WB_SwitchConditionDialog=function(){this.$p=$("<div style='overflow-y:scroll;height:245px;'></div>");this._window=RMC_createDialog("Branch Condition","Use this dialog to modify branch condition",this.$p,590,340,$createDelegate(this.SaveState,this));this.condHtml="<div><div style='display:inline-block;padding:10px;border-bottom:solid 1px #6e8193;border-right:solid 1px #6e8193;background-color:#e2e2e2;'><input class='fm' style='width:200px'/><img style='vertical-align:bottom;margin-left:2px;cursor:pointer' src='/ASP.Net/FM/Common/Images/btn_lookup_off.gif' /><select class='fm' style='width:80px;margin:0 10px'><option value='='> equal </option><option value='not_equal'> not equal </option></select><input class='fm' style='width:125px'/><img style='vertical-align:bottom;margin-left:2px;cursor:pointer' src='/ASP.Net/FM/Common/Images/btn_lookup_off.gif' /></div><select class='fm' style='margin:0 0 -25px 10px;width:50px;disply:block'><option value='or'>or</option><option value='and'>and</option></select></div>"};RMC.WB_SwitchConditionDialog.prototype={Show:function(p,c,h){this._window.show();this.xmlDoc=p;this.$xn_b=c;this.onchange=h;this.$p.empty();var m=c.attr("test");var a=c.attr("details");var k=(a&&a!="")?a.split(";"):(new Array());var b=k.length;m=m.replace(/ OR /g," or ").replace(/ AND /g," and ");var j=0;var d=0;var l=0;while(j!=-1){var g=m.indexOf(" or ",j);if(g==-1){g=1000}var e=m.indexOf(" and ",j);if(e==-1){e=1000}var o=b>l?k[l]:"";if(g<e){var f=m.substr(j,g-j);j=g+4;this.appendCondition(f,"or",false,o)}else{if(g>e){var f=m.substr(j,e-j);j=e+4;this.appendCondition(f,"and",false,o)}else{var f=m.substr(j,m.length-j);j=-1;this.appendCondition(f,"and",false,o)}}l+=1;if(d++>20){break}}this.$btnAdd=$("<a class='fm-link' style='margin:5px;display:block'>add</a>");this.$p.append(this.$btnAdd);this.$btnAdd.addHandler("click",this.add_click,this)},findNextExp:function(a){},add_click:function(){this.appendCondition("","and",true,"")},appendCondition:function(g,n,a,p){var e=$(this.condHtml);if(a){e.insertBefore(this.$btnAdd)}else{this.$p.append(e)}var q=e.children();var m=$(q[0]);var f=$(q[1]);var q=m.children();var l=$(q[0]);var d=$(q[1]);var i=$(q[2]);var k=$(q[3]);var c=$(q[4]);g=g.trim();if(g.indexOf("==")>0){g.replace("==","=")}if(g.indexOf("=")>0){if(g.indexOf(" = ")==-1){g=g.split("=")[0]+" = "+g.split("=")[1]}}var h=g.split(" ");l.val(h[0]);var j=h[1];if(j!="="&&j!="not_equal"){i.append("<option value='"+j+"' checked>"+j+"</option>")}i.val(j);var o=h[2];if(p!=""&&RMC.WB_Utils.isConstant(o)){o=p+"("+o+")"}k.val(o);f.val(n);d.addHandler("click",this.assign_onclick,this);c.addHandler("click",this.assign_onclick,this);c[0].operatorTextBox=l},assign_onclick:function(d){var a=d.target;var f=$(a).prev();var j=this.xmlDoc;var b=a.operatorTextBox;var g="";var h="";if(b){var k=b.val().trim();var c=k.indexOf(":");if(c>0){g=k.substr(0,c);h=k.substr(c+1)}}RMC_OpenOrCreate("RMC.WB_AssignDialog","Assign Field",490,460,RMC.Path+"WorkflowBuilder/Dialogs/AssignDialog.ascx",[RMC.Path+"WorkflowBuilder/Dialogs/assigndialog.js"],function(e){e.component=new RMC.WB_AssignDialog(e)},function(e){e.component.LoadState(j,g,"","",h,f)},null)},field_ondelete:function(c){var a=c.target.parentNode.index;var b=this.$panelAssign.children()[a];AX.Window.confirm("","Are you sure you want to remove this field?",function(){b.deleted=true;$(b).hide()},this)},SaveState:function(){var r="";var o="";var n;var j=this.$p.children("DIV");var g=j.length;for(var c=0;c<g;c++){var q=$(j[c]).children();var k=$(q[0]);var b=$(q[1]);var q=k.children();var h=$(q[0]);var d=$(q[2]);var f=$(q[3]);var m=h.val().trim();var l=f.val().trim();var e=d.val();if(m==""||l==""){continue}n="";if(RMC.WB_Utils.isConstantWithText(l)){var a=l.indexOf("('");if(a>0){n=l.substr(0,a);l=l.substr(a+1,l.length-a-2);if(n.indexOf(";")!=-1){n=n.replace(/;/g,",")}}}o+=n+";";if(c>0){r+=" "+b.val()+" "}r+=(RMC.WB_Utils.fixConstant(m)+" "+e+" "+RMC.WB_Utils.fixConstant(l))}this.$xn_b.attr("test",r);this.$xn_b.attr("details",o);if(this.onchange){this.onchange(r)}return true}};