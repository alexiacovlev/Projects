RMC.WB_AssignDialog=function(a){this._window=a;this._window.setBackground("#999999");this.$p=this._window.$content;this.$sourceList=$("#sourceList",this.$p);this.$itemsList=$("#itemsList",this.$p);$("div.fm-dlg-buttons",this.$p).addClick(this.btn_click,this);this.$sourceList.addClick(this.sourceList_click,this);this.$itemsList.addClick(this.itemsList_click,this);this.$tbValue=$("#tbValue",this.$p)};RMC.WB_AssignDialog.prototype={LoadState:function(m,k,d,j,l,h){this.xmlDoc=m;this.stepName=k;this.fieldName=l;this.relatedTableName=j;this.relatedFieldName=l;this.$relatedTextBox=h;this.$itemsList.empty();this.$tbValue.val("");this.$sourceList.empty();this.$sourceList.append("<div style='font-weight:bold;font-style:italic;padding:5px;color:#000;'>Variables</div>");this.$sourceList.append("<a type='WORKFLOW'>Workflow</a>");this.$sourceList.append("<a type='RUNTIME'>Environment</a>");if(l&&j!=null&&k!=""&&k!="INPUT"&&k!="VAR"){this.$sourceList.append("<a type='VALUES'>Available Values</a>")}this.$sourceList.append("<div style='font-weight:bold;font-style:italic;padding:5px;color:#000;'>Available Steps</div>");var f=$("Settings",this.xmlDoc);for(var e=0;e<f.length;e++){var g=f[e];var c=$(g).parent();var b=c[0].tagName;if(b=="Invoke"||b=="XmlIsland"||b=="CreateRecord"||b=="UpdateRecord"){var a=c.attr("name");this.$sourceList.append("<a type='"+b+"' n='"+a+"' i='"+e+"'>"+c.attr("name")+" ("+c.attr("title")+")</a>")}}this._window.show()},sourceList_click:function(j){var a=j.target;if(this.selectItem(this.$sourceList[0],a)){this.$itemsList[0]._selected=null;this.$itemsList.empty().html("&nbsp;...");var b=a.getAttribute("n");var k=a.getAttribute("type");if(k=="WORKFLOW"){this.$itemsList.html("<a v='INPUT:id'>Input Key Value (INPUT:id)</a>")}else{if(k=="RUNTIME"){this.$itemsList.html("<a v='~APPLICATIONID'>Application ID</a><a v='~APPLICATIONURL'>Application Url</a><a v='~USERID'>Current User ID</a><a v='~NOW'>Current Date and Time</a><a v='~IP'>User IP address</a>")}else{if(k=="VALUES"){this.loadValues()}else{var g=$("Settings",this.xmlDoc);var f=parseInt(a.getAttribute("i"));var h=g[f];this.$itemsList.empty();this.$itemsList.append("<div style='font-weight:bold;font-style:italic;padding:5px;color:#000;'>Assigned fields</div>");var c=$(h).parent();var p=c.find("Assign").children();for(var f=0;f<p.length;f++){var l=p[f].getAttribute("name");this.$itemsList.append("<a v='"+b+":"+l+"'>"+l+"</a>")}if(k=="XmlIsland"){this.$itemsList.append("<div style='font-weight:bold;font-style:italic;padding:5px;color:#000;'>Fieldset</div>");var m=c.find("FieldSet").children();for(var f=0;f<m.length;f++){var l=m[f].getAttribute("name");this.$itemsList.append("<a v='"+b+":"+l+"'>"+l+"</a>")}}else{if(k=="Invoke"){this.$itemsList.append("<div style='font-weight:bold;font-style:italic;padding:5px;color:#000;'>Form fields</div>");var d='{"table":"'+h.getAttribute("table")+'", "form":"'+h.getAttribute("form")+'", "stepName":"'+b+'"}';ExecuteService(d,RMC.Path+"WorkflowBuilder/SupportService.asmx/LoadAssignFieldsHtml",$createDelegate(function(e){this.$itemsList.append(e.d.Value)},this),_fm_onHandlerError)}}}}}}},itemsList_click:function(a){var b=a.target;if(this.selectItem(this.$itemsList[0],b)){this.$tbValue.val(b.getAttribute("v"))}},selectItem:function(a,b){if(b.tagName=="IMG"){b=b.parentNode}if(b.tagName!="A"){return false}if(a._selected){a._selected.className=""}a._selected=b;b.className="sel";return true},loadValues:function(){var a="";if(!this.relatedTableName){var b=$("Settings",this.xmlDoc);for(var c=0;c<b.length;c++){var f=b[c];var e=$(f).parent();if(e.attr("name")==this.stepName){a=f.getAttribute("table");break}}}else{a=this.relatedTableName}if(a){var d='{"table":"'+a+'", "field":"'+this.fieldName+'"}';ExecuteService(d,RMC.Path+"WorkflowBuilder/SupportService.asmx/LoadAssignValuesHtml",$createDelegate(function(g){this.$itemsList.html(g.d.Value)},this),_fm_onHandlerError)}else{this.$itemsList.html("")}},Apply:function(){var a=this.$tbValue.val().trim();if(a){this.$relatedTextBox.val(a)}},btn_click:function(a){switch(_fm_getCommand(a)){case"OK":this.Apply();this._window.close();break;case"X":this._window.close();break}}};