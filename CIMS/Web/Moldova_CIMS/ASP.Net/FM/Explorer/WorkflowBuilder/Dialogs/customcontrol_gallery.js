RMC.WB_Gallery=function(c){this.parentControl=c;this._window=AX.Window.createPopupWindow("Choose Workflow Control",470,470,true,true);var a=this._window.$content;a.append("<style>div.wb-gallery {position:absolute;top:0;left:0;right:0;bottom:30px;background-color:#FFF;border:solid 1px #787878;}div.wb-gallery a { padding:6px;width:350px;height:50px;display:block;border-radius:3px;-webkit-border-radius:3px; moz-border-radius:3px;cursor:pointer;}div.wb-gallery a:hover { background-color:#63a5fe;box-shadow: 2px 2px 4px #000;-webkit-box-shadow: 2px 2px 4px #000;-moz-box-shadow: 2px 2px 4px #000;} }div.wb-gallery a img {width:48px;height:48px; }div.wb-gallery a i { position:relative;top:-18px;left:10px;line-height:20px; font-size:10pt;}div.wb-gallery-list {position:absolute;top:0;left:0;right:0;bottom:30px;background-color:#FFF;border:solid 1px #787878;overflow-y:auto}div.wb-gallery-list a { padding:7px 3px 4px 6px;width:330px;height:20px;display:block;cursor:pointer;font-size:10pt;border-radius:3px;-webkit-border-radius:3px;}div.wb-gallery-list a:hover { background-color:#63a5fe;box-shadow: 2px 2px 4px #000;-webkit-box-shadow: 2px 2px 4px #000;-moz-box-shadow: 2px 2px 4px #000;color:white;} }</style>");this.panel=$("<div class='wb-gallery'></div>");a.append(this.panel);var e="/ASP.Net/FM/Explorer/Images/48/";this.panel.html("<div style='margin:20px;'>loading ...</div>");ExecuteService('{mode:"WORKFLOW"}',FM.Path+"Explorer/Dialogs/DialogService.asmx/GetGalleryList",$createDelegate(this.onGalleryloaded,this),_fm_onHandlerError);this.panel.addHandler("click",this.onclick,this);var d=this._window;var b=$(FM.DialogUtils.buildButton("Close","X",55,"16_close.png",false)).css({position:"absolute",bottom:"3px",right:"1px"}).click(function(){d.close()});a.append(b);this._window.show()};RMC.WB_Gallery.prototype={onclick:function(d){var c=_fm_getCommand(d);if(c==""){return}if(c=="CUSTOM"){var a=d.target.getAttribute("i");if(!a){return}var b=this.galleryItems[parseInt(a)];this.setInvokeProperties(b)}this._window.close()},onGalleryloaded:function(a){var d=a.d;var c="<div style='margin:20px 0 0 50px;'>";for(var b=0;b<d.length;b++){c+="<a cmd='CUSTOM' i='"+b+"'>"+d[b].Title+"</a>"}if(d.length==""){c+="We are sorry, but the gallery is empty. <br/>Please, contact with the responsible person."}c+="</div>";this.panel[0].className="wb-gallery-list";this.panel.html(c);this.galleryItems=d},setInvokeProperties:function(o){var q=this.parentControl.xmlDoc;var f=this.parentControl.$xn;if(!RMC.WB_Gallery.xmlParser){RMC.WB_Gallery.xmlParser=xml_createParser()}var j=xml_loadXML(RMC.WB_Gallery.xmlParser,o.Xml);var n=$(":first",j);f.attr("control",n.attr("type"));f.attr("controlInfo",n.attr("content"));var h=f.find("Assign");var c=h.children();var k=new Array();for(var g=0;g<c.length;g++){var d=c[g];k[d.getAttribute("name")]=d.getAttribute("value")}h.remove();var a=n.children("set");var h=xml_appendFirst(q,f,"Assign");for(var g=0;g<a.length;g++){var e=a[g];var b=e.getAttribute("name");var l=e.getAttribute("value");var m=k[b]||l;var p=xml_appendNode(q,h,"Field");p.attr("name",b);p.attr("value",m)}this.parentControl.redraw()}};