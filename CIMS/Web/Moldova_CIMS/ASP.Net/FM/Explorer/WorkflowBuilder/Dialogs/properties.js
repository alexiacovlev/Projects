RMC.WB_Utils={isConstant:function(a){if(!a){return false}return(a[0]=="'"||a[0]=="#")},fixConstant:function(a){if(a&&a.indexOf(":")==-1&&a[0]!="~"&&a[0]!="#"&&a[0]!="'"&&a[0]!="$"){a="'"+a+"'"}return a},isConstantWithText:function(a){if(!a){return false}return(a[0]!="'"&&a[0]!="#"&&a[a.length-1]==")"&&a[a.length-2]=="'")}};RMC.WB_SettingsPanel=function(b,a,c){this.lookupTableName=new FM.LookupTextControl($("#lookupTableName",b));this.hasForm=a;if(a){this.lookupFormName=new FM.LookupTextControl($("#lookupFormName",b),this.lookupTableName)}this.hasReadonly=c;if(c){this.$cbReadonly=$("#cbReadonly",b)}};RMC.WB_SettingsPanel.prototype={LoadState:function(a){this.$xn_s=a.find("Settings");this.lookupTableName.setValue(this.$xn_s.attr("table"));if(this.hasForm){this.lookupFormName.setValue(this.$xn_s.attr("form"))}if(this.hasReadonly){this.$cbReadonly.prop("checked",this.$xn_s.attr("readonly")=="true")}},SaveState:function(d,c){var b=this.$xn_s;var a=b[0];b.attr("table",this.lookupTableName.getValue());if(this.hasForm){b.attr("form",this.lookupFormName.getValue())}if(this.hasReadonly){xml_updateAttr(b,"readonly",this.$cbReadonly.prop("checked")?"true":"")}}};RMC.WB_AssignPanel=function(a,b){this.$panelAssign=$("#panelAssign",a);this.$btnAdd=$("#btnAdd",a);this.$btnAdd.addHandler("click",this.add_click,this);this.panelSettings=b;this.fieldHtml="<div style='margin:5px;'><label style='width:120px;font-weight:bold;display:inline-block;color:#0464d0;'></label><label>= </label><input class='fm' style='width:250px'/><img style='vertical-align:bottom;margin-left:2px;cursor:pointer' src='/ASP.Net/FM/Common/Images/btn_lookup_off.gif' /><img style='vertical-align:bottom;margin-left:20px;cursor:pointer' src='/ASP.Net/FM/Common/Images/16_delete.gif' /></div>"};RMC.WB_AssignPanel.prototype={LoadState:function(h,g,b){this.xmlDoc=h;this.$xn=g;this.$panelAssign.empty();this.$xn_assign=g.find("Assign");var a=this.$xn_assign.children();var d=false;for(var e=0;e<a.length;e++){var c=a[e];var f=$(this.fieldHtml);this.$panelAssign.append(f);if(b&&c.getAttribute("name")=="_KEYVALUE_"){f.children().last().hide();d=true}this.loadFieldValue(f,c,e)}if(b&&!d&&a.length==0){this.addField("_KEYVALUE_","INPUT:id")}},loadFieldValue:function(h,c,e){h[0].index=e;var g=h.children();$(g[0]).text(c.getAttribute("name"));var a=$(g[2]);$(g[3]).addHandler("click",this.field_onclick,this);$(g[4]).addHandler("click",this.field_ondelete,this);var b=c.getAttribute("value");var f=c.getAttribute("source");var j=c.getAttribute("text");if(f&&b&&b.indexOf(":")==-1&&!RMC.WB_Utils.isConstant(b)){b=f+":"+b}else{if(j&&RMC.WB_Utils.isConstant(b)){b=j+"("+b+")"}}a.val(b)},clearPanel:function(){this.$xn_assign.empty();this.$panelAssign.empty()},addField:function(b,a){var d=xml_appendNode(this.xmlDoc,this.$xn_assign,"Field");d.attr("name",b).attr("value",a);var c=$(this.fieldHtml);this.$panelAssign.append(c);this.loadFieldValue(c,d[0],this.$xn_assign.children().length-1)},add_click:function(){var a=this.getTableName();if(a){if(!RMC.WB_AddFieldDialog.current){RMC.WB_AddFieldDialog.current=new RMC.WB_AddFieldDialog()}RMC.WB_AddFieldDialog.current.Show(a,$createDelegate(this.onadd_field,this))}else{RMC.WorkflowBuilder.promptDialog("Add field",$createDelegate(function(b){this.addField(b,"")},this))}},onadd_field:function(b){if(!b.length){return}var a=this.$xn_assign.children();var e=[];for(var d=0;d<a.length;d++){e[a[d].getAttribute("name")]=true}for(var d=0;d<b.length;d++){var c=b[d];if(!e[c]){this.addField(c,"")}}},field_onclick:function(d){var c=d.target.parentNode.index;var a=this.$xn_assign.children()[c];var k=$(this.$panelAssign.children()[c]);var f=$("INPUT",k);var l=this.xmlDoc;var j=this.$xn.attr("name");var b=this.stepIndex;var h=k.children().first().text();var g=this.getTableName();RMC_OpenOrCreate("RMC.WB_AssignDialog","Assign Field",490,460,RMC.Path+"WorkflowBuilder/Dialogs/AssignDialog.ascx",[RMC.Path+"WorkflowBuilder/Dialogs/assigndialog.js"],function(e){e.component=new RMC.WB_AssignDialog(e)},function(e){e.component.LoadState(l,j,b,g,h,f)},null)},field_ondelete:function(c){var b=c.target.parentNode.index;var a=$(this.$panelAssign.children()[b]);a[0].deleted=true;a.hide()},getTableName:function(){return(this.panelSettings)?this.panelSettings.lookupTableName.getValue():null},SaveState:function(l,d){var g=d.find("Assign");var a=g.children();var h=this.$panelAssign.children();var e=[];for(var f=0;f<h.length;f++){var c=h[f];var j=$("INPUT",c).val().trim();var b=a[f];if(c.deleted){e.push(b)}else{if(b.getAttribute("source")){b.removeAttribute("source")}var k="";if(RMC.WB_Utils.isConstantWithText(j)){var c=j.indexOf("('");if(c>0){k=j.substr(0,c);j=j.substr(c+1,j.length-c-2)}}else{j=RMC.WB_Utils.fixConstant(j)}b.setAttribute("value",j);xml_updateAttribute(b,"text",k)}}if(e.length>0){for(var f=0;f<e.length;f++){$(e).remove()}}return true}};RMC.WB_AddFieldDialog=function(){this.$itemsList=$("<div class='fm_list' style='height:334px;overflow-y:scroll;border:0;'></div>");this.$itemsList.addHandler("click",this.on_click,this);this._window=RMC_createDialog("Add Field","Select the fields from the list below",this.$itemsList,400,430,$createDelegate(this.Apply,this))};RMC.WB_AddFieldDialog.prototype={Show:function(a,c){this.onapply=c;FM.DialogUtils.set_loading(this.$itemsList);this._window.show();var b='{"table":"'+a+'"}';ExecuteService(b,RMC.Path+"WorkflowBuilder/SupportService.asmx/LoadFieldsHtml",$createDelegate(function(d){this.$itemsList.empty().html(d.d.Value)},this),_fm_onHandlerError)},on_click:function(a){var b=a.target;if(b.tagName=="LABEL"){b=b.parentNode}var c=null;if(b.tagName=="A"){var c=$(b.firstChild);c.attr("checked",!c.attr("checked"))}else{if(b.tagName=="INPUT"){c=$(b)}else{return}}if(c.attr("checked")){c.parent().addClass("sel")}else{c.parent().removeClass("sel")}},Apply:function(d){var c=[];var a=this.$itemsList.children();for(var b=0;b<a.length;b++){var f=$(a[b].firstChild);if(f.attr("checked")){c.push(a[b].getAttribute("n"))}}this.onapply(c);return true}};RMC.WB_Properties_BaseInit=function(c,b){b.setBackground("#999999");c._window=b;var a=c.$p=b.$content;c.$tbTitle=$("#tbTitle",a);c.$tbName=$("#tbName",a);$("div.fm-dlg-buttons",a).click($createDelegate(RMC.WB_Properties_BaseClick,c))};RMC.WB_Properties_BaseClick=function(a){switch(_fm_getCommand(a)){case"OK":if(this.SaveState()){this._window.close()}break;case"X":this._window.close();break}};RMC.WB_Properties_BaseLoad=function(b,a,c){b.designer=a;b.xmlDoc=a.xmlDoc;b.$xn=c;b._name=c.attr("name");b._title=c.attr("title");b.$tbTitle.val(b._title);b.$tbName.val(b._name);b._window.show();b.$tbTitle.focus()};RMC.WB_Properties_BaseSave=function(b){b.designer.set_changed(true);var a=b.$tbTitle.val().trim();if(a!=b._title){b.$xn.attr("title",a);b._window.returnValue=true}var c=b.$tbName.val().trim();if(c!=b._name&&c!=""){if(c.indexOf(" ")!=-1){c=c.replace(/ /g,"_")}b._window.returnValue=true;AX.Window.alert("The name for the activity has been changed.\n\n"+b._name+" -> "+c+"\n\nPlease check all referenced assignment and fix it manually.");b.$xn.attr("name",c)}return true};RMC.WB_Invoke=function(a){RMC.WB_Properties_BaseInit(this,a);this.panelSettings=new RMC.WB_SettingsPanel(this.$p,true,true);this.panelAssign=new RMC.WB_AssignPanel(this.$p,this.panelSettings);this.$listProvider=$("#listProvider",this.$p);this.$listProvider.addHandler("change",this.provider_change,this);this.$tbProvider=$("#tbProvider",this.$p)};RMC.WB_Invoke.prototype={LoadState:function(b,c){RMC.WB_Properties_BaseLoad(this,b,c);this.panelSettings.LoadState(c);this.panelAssign.LoadState(this.designer.xmlDoc,c,true);var d=this.$xn.find("Settings").attr("provider")||"";if(d=="DUMMY"){this.$listProvider.val("DUMMY")}else{if(d!=""){this.$listProvider.val("CODE")}else{this.$listProvider.val("")}}var a=(d!=""&&d!="DUMMY");this.$tbProvider.toggle(a);this.$tbProvider.val(a?d:"")},SaveState:function(){var b=this.designer.xmlDoc;this.panelSettings.SaveState(b,this.$xn);this.panelAssign.SaveState(b,this.$xn);var c=this.$listProvider.val();var a=this.$xn.find("Settings");if(c=="DUMMY"){a.attr("provider",c)}else{if(c=="CODE"){a.attr("provider",this.$tbProvider.val())}else{a.removeAttr("provider")}}return RMC.WB_Properties_BaseSave(this)},provider_change:function(a){this.$tbProvider.toggle(this.$listProvider.val()=="CODE")}};RMC.WB_XmlIsland=function(a){a.setSize(500,525);RMC.WB_Properties_BaseInit(this,a);this.panelAssignType=new FM.RadioGroup($("div#panelAssignType",this.$p));this.$panelFieldSet=$("div#panelFieldSet",this.$p);this.$panelFieldSet.addHandler("click",this.fieldset_item_click,this);this.$btnFieldSet=$("a#btnFieldSet",this.$p);this.$btnFieldSet.addHandler("click",this.fieldset_add,this);this.panelSettings=new RMC.WB_SettingsPanel(this.$p,false,false);this.panelAssign=new RMC.WB_AssignPanel(this.$p,this.panelSettings);this.$lblAssignText=$("#lblAssignText",this.$p);this.$row1=$("#row1",this.$p);this.$row2=$("#row2",this.$p);this.$listProvider=$("#listProvider",this.$p);this.$listProvider.addHandler("change",this.provider_change,this);this.$tbProvider=$("#tbProvider",this.$p)};RMC.WB_XmlIsland.prototype={LoadState:function(c,d){RMC.WB_Properties_BaseLoad(this,c,d);this.panelSettings.LoadState(d);this.panelAssign.LoadState(this.designer.xmlDoc,d,true);var e=this.panelSettings.$xn_s.attr("provider")||"";if(e!=""){this.$listProvider.val("CODE")}else{this.$listProvider.val("")}this.$tbProvider.val(e);this.provider_change();var a=this.panelAssign.$xn_assign.children();var b="_KEYVALUE_";this.redrawFieldSet()},provider_change:function(c){var a=(this.$listProvider.val()=="CODE");this.$row1.toggle(!a);this.$row2.toggle(a);this.$lblAssignText.text(!a?"Filter":"Assign Parameters")},redrawFieldSet:function(){this.$panelFieldSet.empty();this.$xn_fieldset=this.$xn.find("FieldSet");this.registered=[];var a=this.$xn_fieldset.children();for(var d=0;d<a.length;d++){var b=a[d];var c=b.getAttribute("name");this.registered[c]=true;var e="<div i='"+d+"'><label style='width:150px;font-weight:bold;display:inline-block;color:#0464d0;line-height:21px;'>"+c+"</label><img style='vertical-align:bottom;margin-left:20px;cursor:pointer' src='/ASP.Net/FM/Common/Images/16_delete.gif' /></div>";this.$panelFieldSet.append(e)}},fieldset_add:function(b){var a=this.panelSettings.lookupTableName.getValue();if(a){if(!RMC.WB_AddFieldDialog.current){RMC.WB_AddFieldDialog.current=new RMC.WB_AddFieldDialog()}RMC.WB_AddFieldDialog.current.Show(a,$createDelegate(this.onselect,this))}else{RMC.WorkflowBuilder.promptDialog("Add Field",$createDelegate(function(c){if(!this.registered[c]){var d=xml_appendNode(this.xmlDoc,this.$xn_fieldset,"Field");d.attr("name",c);this.redrawFieldSet()}},this))}},onselect:function(a){if(!a.length){return}for(var c=0;c<a.length;c++){var b=a[c];if(this.registered[b]){continue}var d=xml_appendNode(this.xmlDoc,this.$xn_fieldset,"Field");d.attr("name",b)}this.redrawFieldSet()},fieldset_item_click:function(b){if(b.target.tagName=="IMG"){var a=b.target.parentNode;AX.Window.confirm("","Are you sure you want to remove this field?",function(){var c=this.$xn_fieldset.children()[parseInt(a.getAttribute("i"))];this.registered[c.getAttribute("name")]=false;$(c).remove();$(a).hide()},this)}},SaveState:function(){this.panelSettings.SaveState(this.xmlDoc,this.$xn);this.panelAssign.SaveState(this.xmlDoc,this.$xn);xml_updateAttr(this.panelSettings.$xn_s,"provider",this.$tbProvider.val().trim());return RMC.WB_Properties_BaseSave(this)}};RMC.WB_DataMapping=function(a){a.setSize(500,360);RMC.WB_Properties_BaseInit(this,a);this.panelAssign=new RMC.WB_AssignPanel(this.$p)};RMC.WB_DataMapping.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.panelAssign.LoadState(this.xmlDoc,b,false)},SaveState:function(){this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_UpdateRecord=function(a){a.setSize(500,440);RMC.WB_Properties_BaseInit(this,a);this.panelSettings=new RMC.WB_SettingsPanel(this.$p,true,false);this.panelAssign=new RMC.WB_AssignPanel(this.$p,this.panelSettings)};RMC.WB_UpdateRecord.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.panelSettings.LoadState(b);this.panelAssign.LoadState(this.xmlDoc,b,(b[0].tagName!="CreateRecord"))},SaveState:function(){this.panelSettings.SaveState(this.xmlDoc,this.$xn);this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_ExecStoredProcedure=function(a){a.setSize(500,420);RMC.WB_Properties_BaseInit(this,a);this.$tbProcedureName=$("#tbProcedureName",this.$p);this.panelAssign=new RMC.WB_AssignPanel(this.$p)};RMC.WB_ExecStoredProcedure.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.$tbProcedureName.val(b.children("Settings").first().attr("method"));this.panelAssign.LoadState(this.xmlDoc,b,false)},SaveState:function(){this.panelAssign.SaveState(this.xmlDoc,this.$xn);var a=xml_getOrCreate(this.xmlDoc,this.$xn,"Settings");a.attr("method",this.$tbProcedureName.val().trim());return RMC.WB_Properties_BaseSave(this)}};RMC.WB_ExecuteRequest=function(a){a.setSize(570,420);RMC.WB_Properties_BaseInit(this,a);this.$trUrl=$("#trUrl",this.p);this.$ExecuteRequest_Type=$("#ExecuteRequest_Type",this.p);this.$ExecuteRequest_Type.change($createDelegate(this.type_changed,this));this.$ExecuteRequest_Url=$("input#ExecuteRequest_Url",this.$p);this.$ExecuteRequest_Method=$("input#ExecuteRequest_Method",this.$p);this.panelAssign=new RMC.WB_AssignPanel(this.$p);$("a#linkUrl",this.$p).addHandler("click",this.webservice_click,this)};RMC.WB_ExecuteRequest.prototype={LoadState:function(a,c){RMC.WB_Properties_BaseLoad(this,a,c);var b=this.$xn.attr("type");this.$ExecuteRequest_Type.val(b);this.$ExecuteRequest_Url.val(this.$xn.attr("url"));var d=(b=="WebService")?this.$xn.find("Settings").attr("method"):"";this.$ExecuteRequest_Method.val(d);this.panelAssign.LoadState(this.xmlDoc,c,false);this.type_changed()},type_changed:function(){var a=this.$ExecuteRequest_Type.val();this.$trUrl.toggle(a=="WebService"||a=="")},webservice_click:function(){var a=this;RMC_OpenOrCreate("RMC.WB_WebServiceDialog","Web Service Dialog",600,570,RMC.Path+"WorkflowBuilder/Dialogs/WebServicedialog.ascx",null,function(b){b.component=new RMC.WB_WebServiceDialog(b)},function(b){b.component.LoadState(a)},null)},SaveState:function(){this.$xn.attr("type",this.$ExecuteRequest_Type.val());this.$xn.attr("url",this.$ExecuteRequest_Url.val());this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_MailService=function(a){a.setSize(600,530);RMC.WB_Properties_BaseInit(this,a);this.$tbFrom=$("#tbFrom",this.$p);this.$tbTo=$("#tbTo",this.$p);this.$tbCC=$("#tbCC",this.$p);this.$tbSubject=$("#tbSubject",this.$p);this.$tbBody=$("#tbBody",this.$p);this.$tbAttachments=$("#tbAttachments",this.$p);this.lookupTemplate=new FM.LookupTextControl($("#lookupTemplate",this.$p));this.field_names=["From","To","CC","Subject","Template","Body","Attachments"];$("#btnPreview",this.$p).addHandler("click",function(){var b=this.lookupTemplate.getValue();if(b){openStdWin("/Templates/"+b+".html","template_preview",600,600)}},this)};RMC.WB_MailService.prototype={LoadState:function(f,h){RMC.WB_Properties_BaseLoad(this,f,h);var c=h.find("Assign").children();var b=new Array();for(var e=0;e<c.length;e++){var d=c[e];b[d.getAttribute("name")]=d.getAttribute("value")}this.$tbFrom.val(b.From||"");this.$tbTo.val(b.To||"");this.$tbCC.val(b.CC||"");this.$tbSubject.val(b.Subject||"");var a=b.Body||"";if(a!=""&&a[0]=="#"){a=a.substr(1)}this.$tbBody.val(a);this.$tbAttachments.val(b.Attachments||"");var g=b.Template||"";if(g!=""&&g[0]=="'"){g=g.substr(1,g.length-2)}this.lookupTemplate.setValue(g)},SaveState:function(){this.$xn.find("Assign").remove();var b=xml_appendFirst(this.xmlDoc,this.$xn,"Assign");var g=new Array();for(var d=0;d<this.field_names.length;d++){var c=this.field_names[d];var f=xml_appendNode(this.xmlDoc,b,"Field");f.attr("name",c).attr("value","");g[c]=f}var e=this.lookupTemplate.getValue();var a=this.$tbBody.val().trim();if(a!=""&&a[0]!="#"){a="#"+a}g.From.attr("value",RMC.WB_Utils.fixConstant(this.$tbFrom.val().trim()));g.To.attr("value",RMC.WB_Utils.fixConstant(this.$tbTo.val().trim()));g.CC.attr("value",RMC.WB_Utils.fixConstant(this.$tbCC.val().trim()));g.Subject.attr("value",RMC.WB_Utils.fixConstant(this.$tbSubject.val().trim()));g.Attachments.attr("value",RMC.WB_Utils.fixConstant(this.$tbAttachments.val().trim()));g.Body.attr("value",(e==""?a:""));g.Template.attr("value",RMC.WB_Utils.fixConstant(e));return RMC.WB_Properties_BaseSave(this)}};RMC.WB_CustomControl=function(a){a.setSize(500,440);RMC.WB_Properties_BaseInit(this,a);this.panelAssign=new RMC.WB_AssignPanel(this.$p);this.$listType=$("#listType",this.$p);this.$tbInfo=$("#tbInfo",this.$p);$("#btnGallery",this.$p).addHandler("click",this.gallery_click,this)};RMC.WB_CustomControl.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.redraw()},redraw:function(){var a=this.$xn.attr("control");this.$listType.val(a);if(a=="GRID"&&this.$listType.val()=="SERVERCONTROL"){this.$listType.append("<option value='GRID' selected='selected'>DATA GRID</option>")}this.$tbInfo.val(this.$xn.attr("controlInfo"));this.panelAssign.LoadState(this.xmlDoc,this.$xn,false)},gallery_click:function(a){window.Runtime_Library.createObject("RMC.WB_Gallery",[FM.Path+"Explorer/WorkflowBuilder/Dialogs/customcontrol_gallery.js"],null,this)},SaveState:function(){this.$xn.attr("control",this.$listType.val());this.$xn.attr("controlInfo",this.$tbInfo.val().trim());this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_SubWorkflow=function(a){a.setSize(500,375);RMC.WB_Properties_BaseInit(this,a);this.panelAssign=new RMC.WB_AssignPanel(this.$p);this.$SubWorkflow_Name=$("input#SubWorkflow_Name",this.$p)};RMC.WB_SubWorkflow.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.panelAssign.LoadState(this.xmlDoc,this.$xn,false);this.$xn_settings=$("Settings",b);this.$SubWorkflow_Name.val(this.$xn_settings.attr("workflow"))},SaveState:function(){this.$xn_settings.attr("workflow",this.$SubWorkflow_Name.val().trim());this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_StateProcess=function(a){a.setSize(500,430);RMC.WB_Properties_BaseInit(this,a);this.panelAssign=new RMC.WB_AssignPanel(this.$p);this.$Name=$("input#StateProcess_Name",this.$p);this.$State=$("input#StateProcess_State",this.$p);this.$table=$("input#StateProcess_TableName",this.$p);this.$mode=$("select#StateProcess_Mode",this.$p);this.$applyforstates=$("input#StateProcess_ApplyForStates",this.$p)};RMC.WB_StateProcess.prototype={LoadState:function(a,b){RMC.WB_Properties_BaseLoad(this,a,b);this.panelAssign.LoadState(this.xmlDoc,this.$xn,false);this.$Name.val(this.$xn.attr("process"));this.$State.val(this.$xn.attr("state"));this.$table.val(this.$xn.attr("table"));this.$mode.val(this.$xn.attr("mode"));this.$applyforstates.val(this.$xn.attr("applyforstates"))},SaveState:function(){var a=this.$Name.val().trim();if(a==""){AX.Window.alert("","Please, define the Process Name")}this.$xn.attr("process",a);this.$xn.attr("state",this.$State.val().trim());this.$xn.attr("table",this.$table.val().trim());this.$xn.attr("mode",this.$mode.val());this.$xn.attr("applyforstates",this.$applyforstates.val().trim());this.panelAssign.SaveState(this.xmlDoc,this.$xn);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_Switch=function(a){a.setSize(600,350);RMC.WB_Properties_BaseInit(this,a);this.$panelBranches=$("div#panelBranches",this.$p);this.$panelBranches.addHandler("click",this.branch_click,this);this.$lblOtherwise=$("div#lblOtherwise",this.$p);$("#btnAdd",this.$p).addHandler("click",this.add_click,this)};RMC.WB_Switch.prototype={LoadState:function(c,d){this.$xn=d;this.xmlDoc=c.xmlDoc;this.designer=c;this._window.show();var e=d.children("Case");this.$panelBranches.empty();for(var b=0;b<e.length;b++){var a=$(e[b]);this.addBranchPanel(a,"")}this.$lblOtherwise.text(this.getSequenceText(d.children("Otherwise")))},addBranchPanel:function(b,a){var e=b.attr("test");if(!e){e="&lt;click to configure&gt;"}var d="<div style='padding:8px 0 8px 15px;'><a cmd='edit' class='fm-link' style='color:#55ac51;width:540px;white-space:nowrap;overflow:hidden;display:inline-block;text-overflow:ellipsis;' title='Click to modify'>"+e+"</a><div style='margin:5px;'><label style='width:490px;display:inline-block;'> "+this.getSequenceText(b)+"</label><a class='fm-link' cmd='delete'>delete</a></div></div>";var c=$(d);c[0].$xn_b=b;c[0].status=a;this.$panelBranches.append(c)},getSequenceText:function(a){var d=a.find("Sequence").children();if(d.length==0){return"go to [ empty sequence ]"}var c=d[0];var b=c.tagName;if(b!="Switch"){b=c.getAttribute("title")}if(!b){b=c.getAttribute("name")}return"go to '"+b+"'"},branch_click:function(c){var d=c.target;if(d.getAttribute("cmd")=="edit"){RMC.WorkflowBuilder.OpenConditionDialog(this.xmlDoc,d.parentNode.$xn_b,function(e){if(!e){e="&lt;click to configure&gt;"}$(d).html(e)})}else{if(d.getAttribute("cmd")=="delete"){var b=d.parentNode.parentNode;var a=b.$xn_b;if(a.parent().children().length==2){AX.Window.alert("","You cannot delete single branch.")}else{if(a.find("Sequence").children().length>0){AX.Window.alert("","This branch contains activities.\nTo delete this branch, please remove all activities.")}else{AX.Window.confirm("","Are you sure you want to remove this branch?",function(){$(b).remove();a.remove()},this)}}}}},add_click:function(){var b=this.$xn.find("Otherwise");var a=xml_createNode(this.xmlDoc,"Case");a.insertBefore(b);a.attr("test","");xml_appendNode(this.xmlDoc,a,"Sequence");this.addBranchPanel(a,"new")},SaveState:function(){this.designer.set_changed(true);this.designer.redraw();return true}};RMC.WB_Properties=function(a){RMC.WB_Properties_BaseInit(this,a);this.$tbDescription=$("#tbDescription",this.$p);this.$cbRoundtrip=$("#cbRoundtrip",this.$p);this.$cbTrace=$("#cbTrace",this.$p);this.$cbRefresh=$("#cbRefresh",this.$p);RMC_initTooltip($("#imgInfo",this.$p));this.panelHandlers=new RMC.WB_Handlers($("#panelHandlers",this.$p))};RMC.WB_Properties.prototype={LoadState:function(b,c){RMC.WB_Properties_BaseLoad(this,b,c);this.$tbDescription.val(this.$xn.attr("description"));var a=this.$xn.children("Handlers");var d=a.find("Roundtrip");this.$cbRoundtrip.prop("checked",(d.attr("enabled")!="false"));this.$cbTrace.prop("checked",(this.$xn.attr("trace")=="true"));this.$cbRefresh.prop("checked",(this.$xn.attr("forceRefresh")=="true"));this.panelHandlers.LoadState(a)},SaveState:function(){xml_updateAttr(this.$xn,"description",this.$tbDescription.val().trim());var a=xml_getOrCreate(this.xmlDoc,this.$xn,"Handlers");var b=xml_getOrCreate(this.xmlDoc,a,"Roundtrip");b.attr("enabled",this.$cbRoundtrip.prop("checked"));this.$xn.attr("trace",this.$cbTrace.prop("checked"));this.$xn.attr("forceRefresh",this.$cbRefresh.prop("checked"));this.panelHandlers.SaveState(this.xmlDoc,a);return RMC.WB_Properties_BaseSave(this)}};RMC.WB_Handlers=function(a){this.$p=a;this.addPanel("Previous","Previous");this.addPanel("Update","Update");this.addPanel("Next","Next")};RMC.WB_Handlers.prototype={addPanel:function(f,c){var e="<div style='margin:3px;'><label style='width:100px;display:inline-block;font-weight:bold;color:#555;'>"+f+"</label><select class='fm' style='width:110px'><option value=''>default</option><option value='true'>custom text</option><option value='false'>hidden</option></select><input class='fm' style='width:150px;display:none;margin-left:10px;'/></div>";var a=$(e);var d=a.children();var b=$(d[1]);b.change(function(){$(this).next().toggle(this.value=="true")});a[0].xn_name=c;a[0].$ddl=b;a[0].$tb=$(d[2]);this.$p.append(a)},loadPanel:function(a,c){var b=c.children(a.xn_name);a.$ddl.val(b.attr("enabled")||"").change();a.$tb.val(b.attr("title")||"")},savePanel:function(a,e,d){var c=d.children(a.xn_name);var b=a.$ddl.val();if(b!=""){if($isNull(c)){c=xml_appendNode(e,d,a.xn_name)}c.attr("enabled",b);c.attr("title",((b=="true")?a.$tb.val().trim():""))}else{c.remove()}},LoadState:function(b){var a=this.$p.children();this.loadPanel(a[0],b);this.loadPanel(a[1],b);this.loadPanel(a[2],b)},SaveState:function(c,b){var a=this.$p.children();this.savePanel(a[0],c,b);this.savePanel(a[1],c,b);this.savePanel(a[2],c,b)}};