// Core Portal Schell Client Script Library
// Alfa-XP, Michael Isipciuc, 2012.
//
AX.Window=function(c,b){this.width=800;this.height=500;this.destroyOnClose=c;this.onclose=null;this.popupMode=(b==true);this.component=null;this.bRecalc=true;this.x=0;this.y=0;this.bMaximized=false;if(this.popupMode){this.$bg=$("<div style='position:absolute;top:0;width:100%;height:100%;display:none;background-color:#000;opacity:0;'></div>");document.body.appendChild(this.$bg[0]);this.$bg.on("mousedown",function(){$(this).css({opacity:0.1}).animate({opacity:0},200)})}else{if(!AX.Window.$shader){AX.Window.$shader=$("<div style='position:absolute;top:0;width:100%;height:100%;display:none;background-color:#000;opacity:0;'></div>");document.body.appendChild(AX.Window.$shader[0]);AX.Window.$shader.on("mousedown",function(){$(this).css({opacity:0.2}).animate({opacity:0.4},400)})}}this.$wnd=$("<div class='mwnd' style='display:none'><div class='hdr'><span class='label'></span><span class='buttons'></span></div><div class='mwnd-body'></div></div>");document.body.appendChild(this.$wnd[0]);this.$hdr=$(this.$wnd.children()[0]);this.$content=$(this.$wnd.children()[1]);this.$label=$("span.label",this.$hdr);this.$buttons=$("span.buttons",this.$hdr);var a="";if(!this.popupMode){a='<a class="wnd-I" title=\''+resx_get(2,"Should you experience any problems with this form - &#10;Please contact us!")+"'></a><a title='"+resx_get(1,"Maximize")+'\' class="wnd-M"></a>'}this.$buttons.html(a+"<a title='"+resx_get(0,"Close")+'\' class="wnd-X"></a>');this.$buttons.click($.proxy(this.btn_click,this));if(typeof(this.$wnd.DragDropExtention)=="function"){this.$wnd.DragDropExtention({handler:this.$label,opacity:0.8})}this.index=null;this.$syswnd=$(window);AX.Window._last=this};AX.Window.prototype={setSize:function(a,d,c){this.width=a;this.height=d;if(c){this.setMaximized()}else{this.bReset=true;var b=this.$syswnd.width();var e=this.$syswnd.height();if(a>b){this.width=a=b}if(d>e){this.height=d=e}this.$wnd.css({width:a+"px",height:d+"px"})}},parseSize:function(b){if(b){var a=b.split(",");this.setSize(parseInt(a[0]),parseInt(a[1]),((a.length>2)&&(a[2]=="true")))}else{this.setSize(800,500,false)}},setCenter:function(){var b=this.width;var c=this.height;var a=Math.floor((this.$syswnd.width()-b)/2);var d=Math.floor((this.$syswnd.height()-c)/2);this.$wnd.css({left:a+"px",top:d+"px"});this.bReset=false},setMaximized:function(){var b=this.$syswnd.width()-2;var c=this.$syswnd.height()-2;var a=0;var d=0;this.$wnd.css({left:a+"px",top:d+"px",width:b+"px",height:c+"px"})},removeBorders:function(){this.$content.css({top:"27px",bottom:"0",left:"0",right:"0"})},setHeader:function(b,a){this.$label.html(b);if(a){this.$label.attr("title",a)}},loadURL:function(b,d,a){if(!this.$frame){this.$frame=$('<iframe style="width:100%;height:100%" frameborder="0" scrolling="'+(a?"yes":"no")+'"></iframe>');this.$content.append(this.$frame);var c=this;this.$frame[0]._window=c;if(d){this.$frame.load(d)}}this.$frame.attr("src",b)},loadHTML:function(a){this.$content.html(a)},loadElement:function(a){this.$content.empty().append(a)},loadASCX:function(c,b,a){this.$content.load("/ASP.Net/System/Component.aspx?path="+c,function(){if(b){Runtime_ResourceLoader.LoadResources(b,a)}else{if(a){a()}}})},show:function(){if(this.bReset){this.setCenter()}if(!this.index){AX.Window.count+=1;this.index=1000+AX.Window.count*10}if(this.popupMode){this.$bg.css({zIndex:this.index,display:""})}else{AX.Window.$shader.css({zIndex:this.index,display:"",opacity:0.4})}this.$wnd.css({zIndex:this.index+1,display:"block"});this.returnValue=null},close:function(){if(this.index==null){return}AX.Window.count-=1;this.index=null;this.$wnd.css("display","none");if(this.popupMode){this.$bg.css("display","none")}else{if(AX.Window.count==0){AX.Window.$shader.animate({opacity:0},200,function(){AX.Window.$shader.css("display","none")})}else{AX.Window.$shader.css({zIndex:(1000+AX.Window.count*10)})}}if(this.onclose){this.onclose(this.returnValue)}if(this.destroyOnClose){this.disposeContent();this.$wnd.remove();if(this.popupMode){this.$bg.remove()}}},disposeContent:function(){if(this.component&&typeof(this.component.dispose)=="function"){this.component.dispose()}this.component=null},maximize:function(a){this.bMaximized=a;var c=(this.$buttons.children()[1]);if(this.bMaximized){this.setMaximized();c.className="wnd-Mn"}else{this.setSize(this.width,this.height);this.setCenter();c.className="wnd-M"}},preventSelection:function(){this.$wnd.preventSelection()},setBackground:function(a){this.$wnd.css("background-color",a)},btn_click:function(b){var a=b.target.className;if(a=="wnd-X"){this.close()}else{if(a=="wnd-M"||a=="wnd-Mn"){this.maximize(!this.bMaximized)}else{if(a=="wnd-I"){App_PostIncident(this)}}}}};AX.Window.create=function(f,e,b,c,a){var d=new AX.Window(true,a);d.setHeader(e);d.setSize(b,c);if(f){d.$content.append(f)}return d};AX.Window.createFrameWindow=function(c,f,b,d,g,a){var e=new AX.Window(true);e.setHeader(f);e.setSize(b,d);e.show();e.loadURL(c,g,a);return e};AX.Window.createPopupWindow=function(g,b,d,a,f){var e=new AX.Window(f,true);if(a){e.$wnd.css("background-color","transparent");var c=e.$content.clone();c.css({opacity:0.8,"background-color":"gray",margin:"-3px"});c.insertBefore(e.$content)}e.setHeader(g);e.setSize(b,d);return e};AX.Window.ImagePath="/ASP.Net/System/Window/Images/";AX.Window.count=0;AX.WindowPanel=function(e,d,b){var a=1100+AX.Window.count*10;if(b){this.$bg=$('<div style="display:none;z-index:'+a+';position:absolute;top:0;left:0;width:100%;height:100%;background-color:#232323;opacity:0;"></div>');document.body.appendChild(this.$bg[0])}this.$wnd=$('<div class="wnd-pnl" style="min-width:400px;display:none;z-index:'+(a+1)+';"><div style="font-size:10pt;font-weight:bold;margin:8px 12px;"/><div class=\'wnd-pnl-X\'/><div style="font-size:10pt;margin:20px"/><div style="text-align:right;margin:10px;"/></div>');var c=this.$wnd.children();$(c[0]).html(e);$(c[2]).append(d);this.$btn_x=$(c[1]);this.$btn=$(c[3]);document.body.appendChild(this.$wnd[0]);this.init=function(j,k){for(var h=0;h<j.length;h++){this.$btn.append(j[h])}var g=j[0];var f=j.length>1?j[1]:null;if(k!=false){this.$wnd.keypress(function(i){if(i.which==13){g.click()}else{if(i.which==27&&f){f.click()}}})}this.$btn_x.click(function(){f?f.click():g.click()})};this.close=function(){this.$wnd.remove();if(this.$bg){this.$bg.remove()}};this.show=function(){var g=$(window);var f=Math.floor((g.width()-this.$wnd.width())/2);var h=Math.floor((g.height()-this.$wnd.height())/2);if(h>50){h-=50}if(this.$bg){this.$bg.css("display","").animate({opacity:0.2},200)}this.$wnd.css({left:f+"px",top:h+"px"}).show();this.$wnd.focus()}};AX.Window.confirm=function(g,c,f,b){var d=new AX.WindowPanel(g,c,true);if(f&&b){f=$createDelegate(f,b)}var a=$('<a class="fm-btn" style="width:60px;font-weight:bold;">'+resx_get(5,"Yes")+"</a>").click(function(){d.close();f()});var e=$('<a class="fm-btn" style="width:60px;margin-left:8px;">'+resx_get(6,"No")+"</a>").click(function(){d.close()});d.init([a,e]);d.show()};AX.Window.alert=function(f,c,e,b){if(!c){c=f||"";f=""}var d=new AX.WindowPanel(f,'<img src="/ASP.Net/System/Images/48_alert.png" style="width:48px;vertical-align:top;margin-right:15px"/><label style="display:inline-block;position:relative;margin-top:12px;">'+c.toString().replace(/\n/g,"<br />")+"</label>",true);if(e&&b){e=$createDelegate(e,b)}var a=$('<a class="fm-btn" style="width:60px;font-weight:bold;">'+resx_get(3,"OK")+"</a>").click(function(){d.close();if(e){e()}});d.init([a]);d.show()};AX.Window.dialog=function(h,f,g,b,e){var d=new AX.WindowPanel(h,f,true);if(g&&b){g=$createDelegate(g,b)}var a=$('<a class="fm-btn" style="width:60px;font-weight:bold;">'+resx_get(3,"OK")+"</a>").click(function(){if(g()){d.close()}});var c=$('<a class="fm-btn" style="width:60px;margin-left:8px;">'+resx_get(4,"Cancel")+"</a>").click(function(){d.close()});d.init([a,c],e);d.show();return d};AX.Window.notify=function(e,d){var c=AX.Window.notifyPanel;if(!c){var a=1101+AX.Window.count*10;c=$('<div class="wnd-n" style="right:2px;bottom:2px;display:none;z-index:'+(a+1)+';"><div style="font-size:10pt;font-weight:bold;margin:8px 12px;"/><div style="font-size:10pt;margin:20px;"/><div style="text-align:right;margin:10px;"/></div>');document.body.appendChild(c[0]);AX.Window.notifyPanel=c}var b=c.children();$(b[0]).text(e);$(b[1]).html(d);if(c[0].timerID){window.clearTimeout(c[0].timerID)}c.slideDown("slow");c[0].timerID=window.setTimeout(function(){c.slideUp("slow");c[0].timerID=null},3000)};