FM.Grid.DblClick=function(b,d){var c=b._settings.getAttribute("openWnd");if(!c){return}var a=FM.Grid.resolveAttributes(b,b._settings.getAttribute("attr"));if(a){window.fmOpenHandler("GRID",b.queryID,"0",a,c,$createDelegate(b.window_onclose,b))}};FM.Grid.MenuClick=function(c,g){var e=(g.tagName=="IMG"||g.tagName=="I")?$(g).parent():$(g);var f=e.attr("cmd");if(!f){return}switch(f){case"popup":FM.Grid.MoreActions(c,e);return;case"admin":FM.Grid.OpenDesigner(c);break;case"export":AX.Window.createFrameWindow(FM.Path+"DataViewer/Print/Export.aspx?queryID="+c.queryID+c.getParameters(),"",500,240);break;case"print":var h=c.getSelectedID();if(h){AX.Window.createFrameWindow(FM.Path+"DataViewer/Print/Form.aspx?queryID="+c.queryID+"&id="+h+"&form="+e.attr("attr"),"",1200,1200,null,true)}break;case"set":FM.Grid.ExecCommand(c,f,e.attr("attr"),true,null);break;case"delete":FM.Grid.ExecCommand(c,"DELETE","",false,fmres("Grid__Confirmation","Confirmation"),fmres("Grid__AreYouSure","Are you sure?"));break;default:var d=e.attr("wnd");var b=FM.Grid.resolveAttributes(c,e.attr("attr"));if(b!=null){window.fmOpenHandler("GRID",c.queryID,f,b,d,$createDelegate(c.window_onclose,c))}break}var a=c.$menu_popup;if(a&&a._vis){a._close()}};FM.Grid.MoreActions=function(a,i){var b=a.$menu_popup;if(!b){b=a.$menu_popup=$(".fm-dg-menupopup",a.$menu);b[0]._btn=i[0];b._close=function(){b.hide().attr("tabIndex",-1);b[0]._btn.className="fm-m-a";b._vis=false};b.blur(b._close).css("z-index",1000)}if(!b._vis){var e=i.position();var g=Math.round(e.left);var f=e.top+i.outerHeight();var h=i.outerWidth();var d=a.$menu.width();var c=b.width();if(g+c>d){g=d-c}b.css({left:g,top:f,minWidth:h});b[0]._btn.className="fm-m-a fm-m-sel";b.attr("tabIndex",100).slideDown("fast");b.focus();b._vis=true}};FM.Grid.ActionClick=function(a,f,d,c){var b=f.getAttribute("h");if(b=="delete"){FM.Grid.ExecCommand(a,"DELETE","",false,fmres("Grid__Confirmation","Confirmation"),fmres("Grid__AreYouSure","Are you sure?"))}else{if(b=="open"){a.row_dblclick(c)}else{alert("not supported")}}};FM.Grid.ExecCommand=function(a,b,i,e,h,j){var g=a.getSelectedIDArray();if(g.length==0){AX.Window.alert(fmres("Grid__NoOne","Not selected."),fmres("Grid__RequireSelect","Please, select the record."));return}if(h){var d=function(){FM.Grid.ExecCommand(a,b,i,false,null)};AX.Window.confirm(h,j,d);return}var c='{"queryID":"'+a.queryID+'","command":"'+b+'","parameters":"'+jsonEncode(i)+'","list":"'+g.toString()+'","confirm_allow":'+e+', "filter":"'+jsonEncode(a.filter)+'","search":"'+jsonEncode(a.search)+'"}';fmExecuteDataService("Grid_ExecCommand",c,function(f){var k=f.d;if(k.Error){AX.Window.alert("Error",k.Error)}else{if(k.Confirmation){FM.Grid.ExecCommand(a,b,i,false,"Confirmation",k.Confirmation)}else{a.Refresh(true,false);if(k.Message){AX.Window.alert("Notification",k.Message)}}}})};FM.Grid.LoadDetails=function(a,g,c,j,d){if(!c.$panelRow){var h=$(c);var f=h.children().length;c.$panelRow=$("<tr><td colspan='"+f+"'></td></tr>");h.after(c.$panelRow);var l=$(c.$panelRow.children()[0]);l.load(FM.Path+"DataViewer/Grid/ExtendRow.ashx?queryID="+a.queryID+"&cmd="+d+"&id="+h.attr("oid"));if(d=="m"){l.addHandler("click",FM.Grid.MDOnClick,a)}c._panelRow_opened=true;g.className=g.className.replace("plus","minus")}else{var k=!c._panelRow_opened;c._panelRow_opened=k;c.$panelRow.css("display",(k)?"":"none");var m=g.className;g.className=(!k)?m.replace("minus","plus"):m.replace("plus","minus")}};FM.Grid.MDOnClick=function(g){var c=this;var h=g.target;if(h.tagName=="TD"){h=h.parentNode}if(h.tagName=="TR"&&h.className=="md-row"){var f=c._settings.getAttribute("md_cmd");var d=c._settings.getAttribute("md_wnd");if(!f){return}var a="id="+h.getAttribute("keyValue");var b=h.getAttribute("pid");window.fmOpenHandler("GRID",c.queryID,f,a,d,$createDelegate(function(e){if(e!=null){this.server_loadDetails(b,"m")}},c))}};FM.Grid.resolveAttributes=function(a,h){var c="";var l=h.split(",");var d,j,e,g;for(var f=0;f<l.length;f++){d=l[f];if(d==""){continue}if(d.indexOf("=")>0){g=d.split("=");j=g[0];e=g[1]}else{j=d;e="["+d+"]"}var k=e.indexOf("[");var b=e.indexOf("$");if(k==0){e=FM.Grid.getParam(e,a)}else{if(k>0){e=e.substring(0,k)+FM.Grid.getParam(e.substring(k),a)}else{if(b==0){e=FM.Grid.getInput(e,a)}else{if(b>0){e=e.substring(0,b)+FM.Grid.getInput(e.substring(b),a)}}}}if(e==null){return null}if(c!=""){c+="&"}c+=(j+"="+e)}return c};FM.Grid.getParam=function(a,c){switch(a){case"[id]":var d=c.getSelectedID();if(d==null){AX.Window.alert(fmres("Grid__NoOne","Not selected."),fmres("Grid__RequireSelect","Please, select the record."));return null}return d;case"[ids]":var b=c.getSelectedIDArray();if(b.length==0){AX.Window.alert(fmres("Grid__NoOne","Not selected."),fmres("Grid__RequireSelect","Please, select the record."));return null}return b.toString();case"[externalFilter]":return c.filter;case"[query_ticket]":return c.queryID;case"[t]":return c.settings("t");default:break}};FM.Grid.getInput=function(e,b){e=e.substr(1);var a=(b.inputParameters!="")?b.inputParameters:window.location.search.substring(1);var d=a.indexOf(e+"=");if(d>=0){d=d+e.length+1;var c=a.indexOf("&",d);return(c!=-1)?a.substr(d,c-d):a.substr(d)}return""};FM.Grid.OpenDesigner=function(f){var d=f.settings("t");var c=f.settings("v");var g="GRID";var b=f.widths;f.widths="";var a=function(h){var j=h.d;if(j.HasError){return}var i=$(j.Html);i.insertAfter(f.$gridBar);f.$gridBar.remove();f.$gridBar=i;f.initSortBar();f.Refresh(false,true)};var e=function(){fmExecuteDataService("Grid_Header",'{"gridID":"'+f.queryID+'"}',$createDelegate(a,this))};FM.ShowAdminWindow("ViewBuilder",950,550,"t="+d+"/v="+c+"/mode="+g+"/w="+b,e)};