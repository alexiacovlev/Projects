FM.PicklistControl=function(){};FM.PicklistControl.prototype={init:function(){this.index=null;this.startIndex=this.base.get("si")=="0"?0:1;this._loaded=this.base.get("loaded")=="1";this.isOpened=false;this.$popup=null;this.filterData="";var a=this.$ui.children();this._label=a[0];this._btn=a[1];this._panel=this._ui.nextSibling;this.$panel=$(this._panel);this.$ui.on("mousedown",$createDelegate(this.onmousedown,this));this.$ui.keydown($createDelegate(this.onkeydown,this));this.$ui.keypress($createDelegate(this.onkeypress,this))},focus:function(){this.$ui.focus()},onmousedown:function(a){if(this.base.Readonly){return}a.preventDefault();if(!this.isOpened){this.$ui.focus();this.prepareList(true,null)}else{var b=a.target;if(b.tagName=="A"){this.setSelected(b);this.hidePanel(true)}else{if(b.tagName=="B"||b.tagName=="LABEL"||b.className=="fm-ddl"){this.hidePanel(true)}}}},onkeydown:function(b){if(this.base.Readonly){return}var a=b.keyCode;if(a==38||a==40||(a==13&&!this.isOpened)){this.prepareList(a==13,a);b.preventDefault()}else{if(a==13&&this.isOpened){this.hidePanel(true)}}},onkeypress:function(b){if(this.base.Readonly){return}var a=b.charCode;if(a<48){return}this.prepareList(false,a)},handleKey:function(b){if(b==38||b==40){if(!this.isOpened){this.defineSelected()}var f=this._selected;if(f){if(b==40){f=f.nextSibling}else{f=f.previousSibling}}else{if(this._panel.firstChild.tagName=="A"){f=this._panel.firstChild}}if(f){this.setSelected(f);this.scrollList()}}else{if(b<48){return}var e=String.fromCharCode(b);var d=e;var f=null;var c=this.$panel.children();for(var a=0;a<c.length;a++){if($(c[a]).text().toLowerCase().indexOf(d)==0){f=c[a];break}}if(f){this.setSelected(f)}}},setSelected:function(b){if(this._selected==b){return}if(this._selected){this._selected.className="fm-o-a"}this._selected=b;if(b){b.className="fm-o-a fm-o-sel";var a=$(b);this.setSelectedValue(a.attr("value"),a.text())}else{this.setSelectedValue("","")}},scrollList:function(){if(!this._selected){return}var c=$(this._selected);var d=c.position().top;var b=this.$panel.scrollTop();var a=250;if(d>a){this.$panel.scrollTop(b+(d-a))}else{if(d<5){this.$panel.scrollTop(b+d)}}},defineSelected:function(){if(this._selected){return this._selected}var d=null;var c=this.base.value;if(c!=""){var b=this.$panel.children();for(var a=0;a<b.length;a++){if(b[a].getAttribute("value")==c){d=b[a];break}}}if(d){d.className="fm-o-a fm-o-sel"}this._selected=d;return d},showPanel:function(){this.defineSelected();var c=this.$popup;if(!c){c=this.$popup=this.$panel.addClass("fm-popup");c.on("mousedown",$createDelegate(this.onmousedown,this))}var d=this.$ui.outerWidth();if(d<100){d=100}var f=this.$ui.offset();var b=f.left;var e=f.top+this.$ui.outerHeight();var a=false;if(!this.isOpened){this.isOpened=true;document.body.appendChild(this.$popup[0]);this.$popup.blur($createDelegate(this.hidePanel,this));a=true}if(c.height()>250){c.css({height:"250px","overflow-y":"scroll"})}c.css({width:d+"px",left:b+"px",top:e+"px","z-index":5000,display:""});if(a){this.scrollList()}this.$popup.attr("tabindex",this.$ui.attr("tabindex"));this.$popup.focus()},hidePanel:function(a){if(this.isOpened){this.$popup.attr("style","display:none;");this.isOpened=false;document.body.removeChild(this.$popup[0]);if(a){this.$ui.focus()}}},prepareList:function(a,b){if(this._loaded){if(b){this.handleKey(b)}if(a){this.showPanel()}}else{if(this.runtime_loading){return}this.runtime_loading=true;var c=this.base.resolveBindings();this._key=b;this._showLoaded=a;var d=this.base.get("pn")+this.base.Name;fmExecuteDataService("Picklist_GetOptions",'{"formID":"'+this.base.hostForm.ticket+'","name":"'+d+'","filterData":"'+c+'"}',$.proxy(this.runtime_onLoaded,this))}},runtime_onLoaded:function(a){this.runtime_loading=false;this._loaded=true;this.$panel.html((this.startIndex!=0?"<a class='fm-o-a' value=''>&nbsp;</a>":"")+a.d);if(this._key){this.handleKey(this._key);this._key=null}else{if(this.auto_sel){this.findAndSelect(this.auto_sel);this.auto_sel=null}}if(this._showLoaded){this._showLoaded=null;this.showPanel()}},setSelectedValue:function(a,b){if(this.base.value!=a){this.base.value=a;$(this._label).text(b);this.base.event_change_fire()}},findAndSelect:function(c){if(this._selected){this._selected.className="fm-o-a";this._selected=null}if(!c){return}var b=this.$panel.children();for(var a=0;a<b.length;a++){if((b[a]).getAttribute("value")==c){this.setSelected(b[a]);break}}},setValue:function(b,c){if(b!=""){if(b.indexOf("|")>0){var a=b.split("|");this.setSelectedValue(a[0],a[2]);return}if(!this._loaded){this.auto_sel=b;this.prepareList(false,null)}else{this.findAndSelect(b)}}else{this.setSelectedValue("","");this.findAndSelect("")}},set_readonly:function(a){this._ui.disabled=a;if(a){this._ui.className="fm-ddl fm-dis";this._btn.className="fm-b-dis fm-btn-ddl"}else{this._ui.className="fm-ddl";this._btn.className="fm-b fm-btn-ddl"}},getText:function(){return $(this._label).text()}};FM.RadioGroupControl=function(){};FM.RadioGroupControl.prototype={init:function(){this.$panel=this.$ui.parent();var a=$.proxy(this.onclick,this);this.$panel.click(a)},focus:function(){$(this._ui.firstChild).focus()},onclick:function(b){var c=b.target;if(c.tagName=="LABEL"){c=c.firstChild}if(c.tagName!="INPUT"){return}var a=c.value;if(this.base.value!=a){this.base.value=a;this.base.event_change_fire()}},setValue:function(b){if(b.indexOf("|")>0){b=b.substring(0,b.indexOf("|"))}this.base.value=b;var c=this.$panel.children();var d;for(var a=0;a<c.length;a++){d=c[a].firstChild;if(d&&d.value==b){d.checked=true;break}}},set_readonly:function(a){if(a){$("INPUT",this.$panel).attr("disabled","disabled")}else{this.$panel.removeAttr("disabled")}},event_change_add:function(){}};