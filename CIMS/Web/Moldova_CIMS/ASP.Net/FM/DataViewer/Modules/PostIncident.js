AX.Incident=function(){this._window=new AX.Window(false,true);this._window.setHeader("...");this._window.setSize(800,500);this._window.loadASCX("/ASP.Net/FM/DataViewer/Modules/PostIncident.ascx",null,$createDelegate(this.init,this))};AX.Incident.prototype={init:function(){var a=this._window.$content;this.$btnOK=$("a#btnOK",a);this.$btnOK.addHandler("click",this.btn_OK,this);$("a#btnClose",a).addHandler("click",this.btn_Close,this);$("a#btnAttach",a).addHandler("click",this.openDialog,this);this.$img=$("#img",a);this.$label=$("#label",a);this.$tbSubject=$("#tbSubject",a);this.$tbDescription=$("#tbDescription",a);this.$ddlType=$("#ddlType",a);this.$ddlPriority=$("#ddlPriority",a);this.$ddlCategory=$("#ddlCategory",a);this.$labels=$("#labels",a);this._window.setHeader(this.$labels.attr("hdr"));this.$frm_upload=$("form#file_upload",a);this._initialized=true;this.$tbSubject.focus();$("a#linkPlugin",a).addHandler("click",function(){this._window.close();var b=$("<div style='width:850px;height:600px'></div>");AX.Window.dialog("",b,function(){return true});b.load("/ASP.Net/FM/DataViewer/Modules/Incidents/help.html")},this)},Show:function(){if(this._initialized){this.$tbSubject.val("").focus();this.$tbDescription.val("");this.$ddlType.val("1");this.$ddlPriority.val("2");this.$ddlCategory.val("1");this.$img.attr("src","/ASP.Net/FM/Common/Images/noimage.gif");this.$label.text("")}this.uploaded_fileid="";this._window.show();var a=this.related_window;if(this._initialized){this.$tbSubject.focus()}},openDialog:function(){if(!this._dialog){var a=!($.browser.msie);this._dialog=new AX.Window(false,true);this._dialog.setHeader(this.$labels.attr("hdr_file"));this._dialog.setSize(500,a?300:200);this._dialog.loadURL(App.SystemPath+"Upload/default.aspx");this._dialog.onUpload=$createDelegate(this.onupload,this)}this._dialog.show()},onupload:function(d,a,b){var c=a.substr(a.lastIndexOf(".")+1).toLowerCase();if(c!="jpg"&&c!="jpeg"&&c!="png"&&c!="gif"){alert(this.$labels.attr("msg1"));return}this.$img.attr("src","/Temp/_Upload/"+d);this.uploaded_fileid=d;this.$label.text(a+". "+fmres("Form__File","The file is received.")+" ");this._dialog.close()},btn_OK:function(){var a=this.$tbSubject.val().trim();if(a==""){AX.Window.alert(this.$labels.attr("msg2"));return}var b={subject:a,description:this.$tbDescription.val().trim(),type:parseInt(this.$ddlType.val()),priority:parseInt(this.$ddlPriority.val()),category:parseInt(this.$ddlCategory.val()),uploaded_fileid:this.uploaded_fileid};this.$btnOK.prop("disabled","disabled");ExecuteService(JSON.stringify(b),"/ASP.Net/FM/DataViewer/Modules/IncidentService.asmx/SaveState",$createDelegate(this.oncomplete,this))},oncomplete:function(){this._window.close();AX.Window.notify(this.$labels.attr("n_hdr"),this.$labels.attr("n_text"))},btn_Close:function(){this._window.close()}};AX.Incident.OpenWindow=function(b,c){if($.browser.chrome&&c){var a=new AX.Window(true,true);a.screenshot=c;a.setSize(900,600,true);a.show();a.loadURL("/ASP.Net/FM/DataViewer/Modules/Incidents/Form.aspx")}else{if(!AX.Incident._instance){AX.Incident._instance=new AX.Incident()}AX.Incident._instance.related_window=b;AX.Incident._instance.Show()}};