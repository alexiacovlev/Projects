FM.Calendar=function(o){this.control=o;this.MinDate=new Date(1900,1,1);this.MaxDate=new Date(2200,11,31);this.ShowWeekNumbers=false;this.FireOnMonth=false;this.$panel=$('<div class="fm-popup fm-cal" style="overflow:none;display:none;z-index:5000;"></div>');this.$panel.on("mousedown",$.proxy(this.panel_click,this));if(!window.DT_AbbreviatedMonthNames){$.get("/ASP.Net/FM/Common/UI/Calendar/settings.js.aspx?lcid="+App.Settings.LCID,$.proxy(function(s){window.eval(s);this.Show()},this))}else{this.Show()}};FM.Calendar.prototype={dispose:function(){},Show:function(){this.Date=this.control.getDate();if(!this.Date){this.Date=new Date();this.Date.setHours(0,0,0,0)}this.DrawCalendar(this.Date,this.Date);if(!this.isOpened){this.isOpened=true;var b=this.control.$dbox;var d=b.offset();var a=d.left;var c=d.top+b.outerHeight();this.$panel.css({left:a,top:c});document.body.appendChild(this.$panel[0]);this.$panel.fadeIn("fast")}},Hide:function(){if(this.isOpened){this.isOpened=false;document.body.removeChild(this.$panel[0])}},OnSelect:function(a){if(this.control){this.control.d_isOpened=false;this.control.setDateValue(a);this.control.base.event_change_fire()}},DrawCalendar:function(t,s){var b,o;var u=s!=null;if(u){b=new Date(s);o=new Date(s);b.setMilliseconds(0);b.setSeconds(0);b.setMinutes(0);b.setHours(0);o.setMilliseconds(999);o.setSeconds(59);o.setMinutes(59);o.setHours(23)}var c=new Date(t);c.setHours(0,0,0,0);var l=new Date();l.setHours(0,0,0,0);var z=l.valueOf();var r=new Date(c.valueOf());var d=r.getMonth();var p=this.ShowWeekNumbers?8:7;c=this.GetFirstDayInCalendar(c);var a="";a+=("<table cellpadding='0' cellspacing='0' style='border-collapse:collapse;table-layout:fixed;width:100%;height:100%;text-align:center;cursor:default'>");a+=("<tr height='22'><td class='fm-cal-hdr' colspan='"+p+"'>");var x=r.valueOf();var h=new Date(c.valueOf());h.setDate(h.getDate()+42);a+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(c<this.MinDate){a+=("nav='0'>&nbsp;</span>")}else{a+=("nav='1' dir='L' d='"+x+"'>&lt;</span>")}a+=("<span d='"+x+"' nav='2' style='display:inline-block;width:70%;'>"+DT_MonthNames[d]+", "+r.getFullYear()+"</span>");a+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(h>this.MaxDate){a+=("nav='0'>&nbsp;</span>")}else{a+=("nav='1' dir='R' d='"+x+"'>&gt;</span>")}a+=("</td></tr>");a+=("<tr style='height:22px;background-color:#eeeeee;'>");var w=0;var q=DT_FirstDayOfWeek;if(this.ShowWeekNumbers){a+=("<td nav='0'></td>")}while(w<7){a+=("<td nav='0'>"+DT_ShortestDayNames[(w+DT_FirstDayOfWeek)%7]+"</td>");w++;q++;if(q>6){q=0}}a+=("</tr>");var y=0;var f="";for(w=0;w<6;w++){a+=("<tr>");for(q=0;q<7;q++){y=c.getDate();x=c.valueOf();f="";if(x==z){f=" style='background-color:#DE8E29;color:#ffffff;'"}var k=(c.getMonth()==d);if(u&&(c.getTime()>=b.getTime()&&c.getTime()<=o.getTime())){f=" style='background-color:#3C9DFF;color:#ffffff;'"}else{if(!k){f=" style='color:#cccccc'"}}if(c.getMonth()!=d){a+=("<td"+f+" d='"+x+"'>"+y+"</td>")}else{a+=("<td"+f+" d='"+x+"'>"+y+"</td>")}c.setDate(y+1)}a+=("</tr>")}a+=(this.getTodayBarHtml(p));a+=("</table>");var n=$(a);var m=n[0].rows;var e;for(var w=2;w<m.length;w++){var g=m[w].cells;for(var v=0;v<g.length;v++){e=$(g[v]);e.hover(function(j){this.className="fm-cal-sel"},function(j){this.className=""})}}this.$panel.empty().append(n)},DrawMonths:function(j,k){var b=new Date(j);b.setMonth(0);b.setDate(1);var c=-1;var a=3;var e="";e+=("<table cellpadding='0' cellspacing='0' style='border-collapse:collapse;table-layout:fixed;width:100%;height:100%;text-align:center;cursor:default'>");e+=("<tr height='22'><td class='fm-cal-hdr' colspan='"+a+"'>");var f=b.valueOf();var h=b.getFullYear();e+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(h<=this.MinDate.getFullYear()){e+=("nav='0'>&nbsp;</span>")}else{e+=("nav='2' dir='L' d='"+f+"'>&lt;</span>")}e+=("<span d='"+f+"' nav='3' style='display:inline-block;width:70%;'>"+h+"</span>");e+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(h>=this.MaxDate.getFullYear()){e+=("nav='0'>&nbsp;</span>")}else{e+=("nav='2' dir='R' d='"+f+"'>&gt;</span>")}e+=("</td></tr>");var d=0;for(i=0;i<4;i++){e+=("<tr>");for(ii=0;ii<3;ii++){d=b.getMonth();f=b.valueOf();e+=("<td style='border:1px solid #7288ac;");if(d==c){e+=("background-color:#3C9DFF;color:#ffffff;")}e+=("(' d='"+f+"' nav='1'>"+DT_AbbreviatedMonthNames[d]+"</td>");b.setMonth(d+1)}e+=("</tr>")}e+=(this.getTodayBarHtml(3));e+=("</table>");var g=$(e);this.$panel.empty().append(g)},DrawYears:function(e){var a=new Date(e);a.setMonth(0);a.setDate(1);var f=3;var g="";g+=("<table cellpadding='0' cellspacing='0' style='border-collapse:collapse;table-layout:fixed;width:100%;height:100%;text-align:center;cursor:default'>");g+=("<tr height='22'><td class='fm-cal-hdr' colspan='"+f+"'>");var c=a.getFullYear();var d=c-7;var b=c+7;g+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(d<=this.MinDate.getFullYear()){g+=("nav='0'>&nbsp;</span>")}else{g+=("nav='3' dir='L' d='"+a.setYear(d).valueOf()+"'>&lt;</span>")}g+=("<span style='display:inline-block;width:70%;'>"+d+" - "+ +b+"</span>");g+=("<span style='display:inline-block;width:20px;cursor:pointer;' ");if(b>=this.MaxDate.getFullYear()){g+=("nav='0'>&nbsp;</span>")}else{g+=("nav='3' dir='R' d='"+a.setYear(b).valueOf()+"'>&gt;</span>")}g+=("</td></tr>");for(i=0;i<5;i++){g+=("<tr>");for(ii=0;ii<3;ii++){g+=("<td style='border:1px solid #7288ac;' d='"+a.setYear(d).valueOf()+"' nav='2'>"+(d++)+"</td>")}g+=("</tr>")}g+=(this.getTodayBarHtml(3));g+=("</table>");this.$panel.empty().append($(g))},getTodayBarHtml:function(a){return""},panel_click:function(h){var l=h.target;h.preventDefault();var k=l.getAttribute("d");if(!k){return}var j=l.getAttribute("nav");var f=l.getAttribute("dir");var g=new Date(parseInt(k));switch(j){case"1":var b=g.getMonth();var k=g.getDate();var c=new Array(31,28,31,30,31,30,31,31,30,31,30,31);if(g.getYear()%4==0){c[1]=29}if(f=="L"){b--;if((b>0)&&(k>c[b])){g.setDate(c[b])}g.setMonth(b)}else{if(f=="R"){b++;if((b<12)&&(k>c[b])){g.setDate(c[b])}g.setMonth(b)}}if(this.FireOnMonth){g.setHours(this.Date.getHours());g.setMinutes(this.Date.getMinutes());this.Date=g;this.OnSelect(g)}else{this.DrawCalendar(g,null)}break;case"2":if(f=="L"){g.setYear(g.getFullYear()-1)}else{if(f=="R"){g.setYear(g.getFullYear()+1)}}this.DrawMonths(g);break;case"3":if(f=="L"){g.setYear(g.getFullYear()-1)}else{if(f=="R"){g.setYear(g.getFullYear()+1)}}this.DrawYears(g);break;default:this.Hide();g.setHours(this.Date.getHours());g.setMinutes(this.Date.getMinutes());this.Date=g;this.OnSelect(g);break}},GetFirstDayInCalendar:function(b){b.setDate(1);var a=b.getDay()-DT_FirstDayOfWeek;if(a<0){a+=7}if(a==0){return b}b.setDate((a*-1)+1);b.setHours(0);b.setMinutes(0);b.setSeconds(0);return b}};