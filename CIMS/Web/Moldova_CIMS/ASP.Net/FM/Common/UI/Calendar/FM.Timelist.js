FM.Timelist=function(e){this.control=e;var d=this.control.$tbox;d.addHandler("change",this.timebox_onchange,this);var b="00";var a="00";var c=App.Settings.ShortTimePattern;this.h_two_digits=c.indexOf("hh")!=-1;this.m_two_digits=c.indexOf("mm")!=-1;this.ampm=c.indexOf(" tt")>0;this.hnd_onblur=$createDelegate(this.focus_lost,this)};FM.Timelist.prototype={dispose:function(){},onselect:function(g){this.hide();var b=g.target.value;if(!b){return}var c=parseInt(b.split(":")[0],10);var a=parseInt(b.split(":")[1],10);var f=this.control.getDate()||(new Date());f.setHours(c);f.setMinutes(a);var d=g.target;this.control.$tbox.val($(d.options[d.selectedIndex]).text());this.control.setDateValue(f);this.control.base.event_change_fire();this.control.$tbox.focus()},prepareList:function(){if(this.$panel){return}var f="<select size='15' style='height:100%;border:0;width:100%;padding:1px;' class='fm-select'>";var e="";var d=0;var a=20;var g=this.control.base.get("r");if(g&&g.indexOf("|")>0){d=parseInt(g.split("|")[0]);a=parseInt(g.split("|")[1])}var b=d;for(var c=d;c<a;c++){e="";h=b.toString();if(this.h_two_digits&&b<10){h="0"+h}if(this.ampm){e=(c>11)?" PM":" AM";if(b==0||b==12){h="12";b=0}}if(c==12){f+="<optgroup label='Noon'/>"}f+="<option value='"+c+":00'>"+h+":00"+e+"</option>";if(d!=0){f+="<option value='"+c+":10'>"+h+":10"+e+"</option><option value='"+c+":20'>"+h+":20"+e+"</option>"}f+="<option value='"+c+":30'>"+h+":30"+e+"</option>";if(d!=0){f+="<option value='"+c+":40'>"+h+":40"+e+"</option><option value='"+c+":50'>"+h+":50"+e+"</option>"}b++}f+="</select>";this.$select=$(f);this.$panel=$('<div style="height:160px;z-index:5000;" class="fm-popup"></div>');this.$panel.append(this.$select);this.$select.addHandler("change",this.onselect,this)},toggle:function(){if(this.isOpened){this.hide();this.control.$tbox.focus()}else{this.show()}},show:function(){if(this.isOpened){return}this.isOpened=true;this.prepareList();document.body.appendChild(this.$panel[0]);this.$panel.fadeIn("fast");this.$select.focus().blur(this.hnd_onblur);var c=this.control.$tbox;var b=c.outerWidth();if(b<80){b=80}var e=c.offset();var a=e.left;var d=e.top+c.outerHeight();this.$panel.css({left:a,top:d,width:b+"px"})},hide:function(){if(!this.isOpened){return}this.isOpened=false;document.body.removeChild(this.$panel[0])},focus_lost:function(){this.hide()},timebox_onchange:function(i){var l=i.target;var n=l.value.trim();var a=this.control.getDate()||(new Date());try{var j=App.Settings.ShortTimePattern;var i="The time is wrong, please use format: "+j;var d=n.indexOf(":");if(d==-1){n+=":00";d=n.indexOf(":")}var g=n.substr(0,d);var b=n.substr(d+1);var f=parseInt(g,10);if(isNaN(f)){f=0;g="00"}if(this.ampm){var c=b.indexOf(" ");if(c>0){if(b.substr(c+1).toLowerCase()=="pm"){f+=12}b=b.substr(0,c)}}if(f<0||f>23){f=12;g="12"}m=parseInt(b,10);if(isNaN(m)){m=0;b="00"}if(m<0||m>59){m=0}a.setHours(f);a.setMinutes(m);var k="";if(this.ampm){var k=(f<12)?" AM":" PM";if(f==0){g="12"}}n=((this.h_two_digits&&f<10)?"0":"")+g+":"+((this.m_two_digits&&m<10)?"0":"")+m+k;this.control.base.value=DT_formatUtcDate(a);this.control.base.event_change_fire()}catch(i){this.control.base.showTooltip(i);n=""}l.value=n},};