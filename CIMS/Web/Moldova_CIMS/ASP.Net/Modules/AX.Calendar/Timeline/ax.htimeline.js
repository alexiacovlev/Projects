AX.HTimeline=function(c){var b=c.children()[0];this.url=b.getAttribute("source");this.singlemode=(b.getAttribute("mode")=="single");this.handlerName=b.getAttribute("handler");this.p=b;var a=$("<div class='ax-htm-div'></div>");$(b).empty().append(a);this.$p=a;this.day_w=16;this.group_w=70;this.startPos=this.group_w;this.style0="background-color:#7cb5ec;border-color:#368ce2;";this.style1="background-color:#4f4f4f;border-color:#363636;color:#FFF;";this.load();if(this.handlerName){this.$p.addHandler("click",this.onclick,this)}};AX.HTimeline.prototype={load:function(){$.getJSON(this.url,$.proxy(function(a){this.data=a;this.redraw()},this))},redraw:function(){this.$p.empty();if(this.data.length==0){this.$p.html("<div style='padding:20px;font-style:italic'>no data</div>");return}this.start=this.ParseUtcDate(this.data[0].Start);this.end=this.ParseUtcDate(this.data[0].End);this.startTime=this.start.getTime();this.startDay=this.data[0].StartDay;this.endDay=this.data[0].EndDay;this.totalDays=this.endDay;var h=this.p.offsetWidth;this.panelWidth=this.startPos+this.day_w*this.totalDays+400;if(this.panelWidth<h){this.panelWidth=h-20}this.$p.css("width",this.panelWidth+"px");this.k=this.day_w;this.kpx=this.day_w/(1000*3600*24);var c=this.start.getMonth();var g=new Date(this.start.getFullYear(),c,1);var e="<div class='ax-tm-header'>";for(var d=0;d<this.data.length;d++){var f=this.data[d];if(f.Type==1){var a=this.startPos+f.StartDay*this.day_w;var b=this.startPos+f.EndDay*this.day_w;if(d==0){e+="<b style='position:absolute;top:5px;left:"+a+"px'>"+this.DateToString(this.ParseUtcDate(f.Start))+"</b>"}e+="<b style='position:absolute;top:5px;left:"+b+"px'>"+this.DateToString(this.ParseUtcDate(f.End))+"</b>";if(d==0){this.$p.append("<div class='ax-tm-line' style='left:"+a+"px'/>")}this.$p.append("<div class='ax-tm-line' style='left:"+b+"px'/>")}}e+="</div>";if(this.currentPos>0){this.$p.append("<div class='ax-tm-cur' style='left:"+(this.startPos+this.currentPos)+"px' title='"+this.DateToString(this.date)+"'/>")}this.$p.append(e);for(var d=1;d<this.data.length;d++){this.drawGroup(this.$p,this.data[d])}},drawGroup:function(d,h){var i="";i+="<div class='ax-htm-item'>";i+="<label class='ax-htm-itemtitle'>"+h.Number+"</label>";var b=h.Type!=1?h.Title:null;var c=h.Type!=1?((h.EndDay-h.StartDay)+" days"):h.Title;var e=h.Start.replace("T"," ")+" - "+h.End.replace("T"," ");var f=this.startPos+h.StartDay*this.day_w;if(h.Type!=-1){var a=(h.Type==1)?this.style1:this.style0;var g=(h.EndDay-h.StartDay)*this.day_w;i+='<div class="ax-tm-box" oid="'+h.ID+'" style="left:'+f+"px;width:"+g+"px;cursor:pointer;"+a+'" title="'+e+'">'+c+"</div>"}else{i+='<div class="ax-htm-ms" oid="'+h.ID+'" style="left:'+f+'px;cursor:pointer;" title="'+e+'"></div>'}if(b){i+="<i style='left:"+(f+5)+"px' class='ax-tm-right'>"+b+"</i>"}i+="</div>";d.append(i)},DateToString:function(b){if(!b){return""}var a=b.getDate();var d=b.getMonth();var c=b.getFullYear();return a+" "+this.ShortMonths[d]+" "+c},ParseUtcDate:function(a){if(a){return new Date(parseInt(a.substr(0,4),10),(parseInt(a.substr(5,2),10)-1),parseInt(a.substr(8,2),10))}else{return null}},onclick:function(a){var b=a.target;if(b.tagName=="I"){b=b.parentNode}if(b.className=="ax-tm-box"||b.className=="ax-htm-ms"){window.fmOpenHandler("CUSTOM/HANDLER",this.handlerName,"open","id="+b.getAttribute("oid"),"900,600",null)}},ShortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};