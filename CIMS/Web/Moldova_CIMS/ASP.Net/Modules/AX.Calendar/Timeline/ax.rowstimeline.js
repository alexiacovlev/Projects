AX.RowsTimeline=function(b){var a=b.children()[0];this.url=a.getAttribute("source");this.handlerName=a.getAttribute("handler");this.p=a;this.$p=$(a);this.group_w=230;this.startPos=this.group_w;this.styles=["background-color:#5ba2f7;border-color:#338af4","background-color:#5ba2f7;border-color:#338af4","background-color:#46d269;border-color:#21893c","background-color:#46d269;border-color:#21893c"];this.load();if(this.handlerName){this.$p.addHandler("click",this.onclick,this)}};AX.RowsTimeline.prototype={load:function(){$.getJSON(this.url,$.proxy(function(a){this.data=a;this.redraw()},this))},redraw:function(){this.$p.empty();var g=this.data.Items;if(!g||g.length==0){this.$p.html("<div style='padding:20px;font-style:italic'>no data</div>");return}var h=new Date();var k=h.getFullYear();var c=h.getMonth();var f=h.getDate();this.start=this.ParseUtcDate(this.data.Start);this.end=this.ParseUtcDate(this.data.End);this.today=h;this.startTime=this.start.getTime();var r=this.start.getMonth();var o=this.start.getFullYear();var p=(1000*3600*24);this.totalDays=Math.round((this.end.getTime()-this.startTime)/p);this.currentDay=Math.round((this.today.getTime()-this.startTime)/p);var a=new Date(o,r,1);var b=12*(this.end.getFullYear()-o)+(this.end.getMonth()-r);var n=this.p.offsetWidth;this.panelWidth=n-this.startPos-21;this.k=this.panelWidth/this.totalDays;this.kpx=this.panelWidth/(this.totalDays*p);this.currentPos=Math.round(this.currentDay*this.k);var t="<div class='ax-tm-header'>";for(var e=0;e<b+1;e++){var q=Math.round((a.getTime()-this.startTime)/p);var l=this.ShortMonths[a.getMonth()];if(r==0){l+=" "+a.getFullYear()}var j=this.startPos+Math.round(this.k*q);t+="<b style='position:absolute;top:5px;left:"+(j)+"px'>"+l+"</b>";this.$p.append("<div class='ax-tm-line' style='left:"+j+"px'/>");r++;if(r==12){r=0;a.setFullYear(a.getFullYear()+1)}a.setMonth(r)}t+="</div>";this.$p.append("<div class='ax-tm-cur' style='left:"+(this.startPos+this.currentPos)+"px' title='"+this.DateToString(this.date)+"'/>");this.$p.append(t);for(var e=0;e<g.length;e++){this.drawItem(this.$p,g[e])}},drawItem:function(b,g){var f="";f+="<div class='ax-rtm-item' oid='"+g.ID+"'>";f+="<label class='ax-rtm-itemtitle' style='width:"+this.group_w+"px'>"+g.Title+"</label>";var h=g.Dates;for(var e=0;e<h.length;e++){if(!h[e]){continue}var j=this.ParseUtcDate(h[e]);var c=j.getTime()-this.startTime;var a=this.startPos+Math.round(c*this.kpx);f+='<div class="ax-rtm-d" style="left:'+a+"px;"+this.styles[e]+'" title="'+this.DateToString(j)+'"></div>'}f+="</div>";b.append(f)},DateToString:function(b){if(!b){return""}var a=b.getDate();var d=b.getMonth();var c=b.getFullYear();return a+" "+this.ShortMonths[d]+" "+c},ParseUtcDate:function(a){if(a){return new Date(parseInt(a.substr(0,4),10),(parseInt(a.substr(5,2),10)-1),parseInt(a.substr(8,2),10))}else{return null}},onclick:function(a){var b=a.target;if(b.tagName=="I"||b.tagName=="LABEL"){b=b.parentNode}if(b.className=="ax-rtm-item"){window.fmOpenHandler("CUSTOM/HANDLER",this.handlerName,"open","id="+b.getAttribute("oid"),"1000,700",null)}},ShortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};