Portal.AppSettingsDialog=function(a){this.$p=a;this._window=AX.Window.dialog("Application Settings",this.$p,this.save,this,false);this.init()};Portal.AppSettingsDialog.prototype={init:function(){var b=this.$p;var a=b.find("#appSettings",b);this.$tbTitle=$("#tbTitle",b);this.$tbTitle.val(a.attr("apptitle"));this.resTitle=new Portal.ResTitle(this.$tbTitle,null);this.resTitle.setResValue(a.attr("restitle"));this.$tbDescription=$("#tbDescription",b);this.$tbDescription.val(a.attr("appdescription"));this.resDescription=new Portal.ResTitle(this.$tbDescription,null);this.resDescription.setResValue(a.attr("resdescription"));this.$tbDbPrefix=$("#tbDbPrefix",b);this.$listThemes=$("#listThemes",b);this.$tbTitle.focus()},save:function(){var d=this.$tbTitle.val().trim();if(d==""){return}var a=this.resTitle.getResValue();var c=this.$tbDescription.val().trim();var b=this.resDescription.getResValue();Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/SaveAppSettings",{name:"default",title:d,description:c,restitle:a,resdescription:b,dbprefix:this.$tbDbPrefix.val().trim(),theme:this.$listThemes.val(),},$createDelegate(this.close,this));$("#appTitle").html(d);$("#appDesc").html(c)},close:function(){this._window.close()}};Portal.ChangeContentDialog=function(c,b,d,a){this.$p=c;this.tab_name=b;this.tab_type="";this.tab_content="";this.OnChanged=a;this._window=AX.Window.dialog("Add/Change Content",this.$p,this.save,this,false);this.init()};Portal.ChangeContentDialog.prototype={init:function(){var a=this.$p;this.$linkBack=$("#linkBack",a);this.$linkBack.addHandler("click",this.btn_back_click,this);this.$panelMain=$("#panelMain",a);this.app_prefix=this.$panelMain.attr("app_prefix");this.$listTypes=$("#listTypes",a);this.$listTypes.addHandler("change",this.on_type_changed,this);this.panels=$("#panelList",a).children()},on_type_changed:function(){var a=this.$listTypes[0].selectedIndex;this.panels.hide();this.$currentDetails=$(this.panels[a]);$(this.panels[a]).fadeIn(200);var b="";switch(this.$listTypes.val()){case"HTML":b=this.tab_name;break;case"PROFILE":b=this.app_prefix;this.loadEntities("PROFILE",this.$currentDetails.find("SELECT"));break;case"WORKFLOW":b=this.app_prefix;this.loadEntities("WORKFLOW",this.$currentDetails.find("SELECT"));break}this.$currentDetails.find("INPUT").val(b).focus()},loadEntities:function(b,a){if(a[0].loaded){return}Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/LoadEntitiesList",{type:b},function(c){a[0].loaded=true;var f=c.d;var e='<option value="">Or select existed from the list</option>';for(var d=0;d<f.length;d++){e+=('<option value="'+f[d]+'">'+f[d]+"</option>")}a.html(e)})},save:function(){this.tab_type=this.$listTypes.val();this.tab_content="";if(this.tab_type==""){return}var b=$(this.panels[this.$listTypes[0].selectedIndex]);var a=b.find("INPUT");switch(this.tab_type){case"HTML":this.tab_content=a.val().trim();if(this.tab_content==""){this.tab_content=this.tab_name}break;case"PROFILE":this.tab_content=b.find("SELECT").val();if(this.tab_content==""){this.tab_content=a.val().trim();if(this.tab_content==""||this.tab_content==this.app_prefix){Portal.Validators.notify(a,"Profile Name");return}}break;case"WORKFLOW":this.tab_content=b.find("SELECT").val();if(this.tab_content==""){this.tab_content=a.val().trim();if(this.tab_content==""||this.tab_content==this.app_prefix){Portal.Validators.notify(a,"Workflow Name");return}}break;case"SERVERCONTROL":this.tab_content=a.val().trim();if(this.tab_content==""){Portal.Validators.notify(a,"Control Settings");return}break}this.service_ChangeContent()},service_ChangeContent:function(){if(this.tab_name==""){return}Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/ChangeContent",{name:this.tab_name,type:this.tab_type,content:this.tab_content},$createDelegate(this.service_OnChangeContent,this))},service_OnChangeContent:function(){if(this.OnChanged){this.OnChanged(this.tab_type,this.tab_content)}this._window.close()}};Portal.PermissionDialog=function(c,b,f,e,d,a){this.$p=c;this.roles=e;this.deny_roles=d;this.onchanged=a;this._window=AX.Window.dialog("Permissions for "+f,this.$p,this.save,this,false);this.init()};Portal.PermissionDialog.prototype={init:function(){var a=this.$p;$("#rbEveryone",a).addHandler("click",this.resetChecks,this);$("#rbMembers",a).addHandler("click",this.resetChecks,this);var e=$("#listRoles",a);$("INPUT",e).addHandler("click",this.resetRadio,this);var d=this.roles;if(d==""){$("#rbEveryone",a).attr("checked","checked");this.toggleDenyRoles(true)}else{if(d=="Members"){$("#rbMembers",a).attr("checked","checked");this.toggleDenyRoles(true)}else{var c=d.split(",");for(var b=0;b<c.length;b++){e.find("INPUT[n='"+c[b]+"']").attr("checked","checked")}this.toggleDenyRoles(false);this.deny_roles=""}}$("#tbDenyRoles",a).val(this.deny_roles)},toggleDenyRoles:function(a){$("#tbDenyRoles",this.$p).prop("disabled",!a)},resetRadio:function(){$("#rbEveryone",this.$p).removeAttr("checked");$("#rbMembers",this.$p).removeAttr("checked");this.toggleDenyRoles(false)},resetChecks:function(){$("#listRoles INPUT",this.$p).removeAttr("checked");this.toggleDenyRoles(true)},close:function(){this._window.close()},save:function(){var d="";if($("#rbEveryone",this.$p).is(":checked")){d=""}else{if($("#rbMembers",this.$p).is(":checked")){d="Members"}else{var e=$("#listRoles INPUT",this.$p);for(var b=0;b<e.length;b++){var a=$(e[b]);if(a.is(":checked")){if(d.length>0){d+=","}d+=a.attr("n")}}if(d==""){AX.Window.alert("Please, define permission for the tab.");return}}}var c=(d==""||d=="Members")?$("#tbDenyRoles",this.$p).val().trim():"";this.onchanged(d,c);this.close()},};Portal.AppThemesDialog=function(a){this.$p=a;this._window=AX.Window.dialog("Available Themes",this.$p,this.save,this,false);this.init()};Portal.AppThemesDialog.prototype={init:function(){var a=this.$p;this.list=new FM.ListBox(a.find("div.fm-list:first"));this.list.setValue(window.Theme)},save:function(){var a=this.list.getValue();if(a!=window.Theme){window.Theme=a;Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/SaveTheme",{theme:a},function(){window.location.reload()})}},close:function(){this._window.close()}};