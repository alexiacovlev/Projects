$registerNamespace("Portal");Portal.AdminPath="/ASP.Net/WebAdmin/";Portal.AppManager=function(){this.$p=$("<div></div>");this.$p.loadASCX(Portal.AdminPath+"AppManager/Portal.AppManager.ascx",[Portal.AdminPath+"admin_styles.css",Portal.AdminPath+"admin_utils.js"],$createDelegate(this.onready,this));App.UI.Content.empty().append(this.$p)};Portal.AppManager.prototype={onready:function(){var a=this.$p;this._selected=null;this._selected_name="";var b={click:this.onclick,drop:this.ondrop,dragenter:this.preventDefault,dragover:this.ondragover,dragleave:this.ondragleave,};this.$tabsItems=a.find("#tabsItems");this.$tabsItems.children().prop("draggable",true).addHandler("dragstart",this.ondragstart,this);this.$tabsItems.addHandlers(b,this);this.$linksItems=a.find("#linksItems");this.$linksItems.children().prop("draggable",true).addHandler("dragstart",this.ondragstart,this);this.$linksItems.addHandlers(b,this);a.find("#theme").text(window.Theme);this.$panelProperties=$("#panelProperties",a);this.$tbTitle=$("#tbTitle",a);this.$tbTitle.addHandler("change",this.title_onchange,this);this.resTitle=new Portal.ResTitle(this.$tbTitle,$createDelegate(this.restitle_onchange,this));this.$tbName=$("#tbName",a);this.$linkRoles=$("#linkRoles",a);this.$linkType=$("#linkType",a);this.$tbContent=$("#tbContent",a);this.$cbVisibility=$("#cbVisibility",a);this.$rowContent=$("#rowContent",this.$panelProperties);this.$tbContent=$("#tbContent",this.$panelProperties);this.$lblContent=$("#lblContent",this.$panelProperties);this.$panelSetters=$("#panelSetters",this.$panelProperties);this.$linksRoot=$("#linksRoot",this.$panelProperties);this.$cbVisibility.addHandler("click",this.on_visibility_click,this);this.$logoIcon=$("#logoIcon",this.$panelProperties);this.$logoIcon.addHandler("click",this.openIconDialog,this);this._service_onload=$createDelegate(this.service_onload,this);this.$panelAppend=$("#panelAppend",a);$("A",a).addHandler("click",this.on_btn_click,this);$("#panelMenu",this.$p).show(150);this.load(App.nodeName)},load:function(d){var c=this.$tabsItems.children();for(var b=0;b<c.length;b++){if(c[b].getAttribute("n")==d){this.selectNode(c[b],true);break}}var a=this.$linksItems.children();for(var b=0;b<a.length;b++){if(a[b].getAttribute("n")==d){this.selectNode(a[b],true);break}}},selectNode:function(b,a){if(this._selected){$(this._selected).removeClass("ax-admin-folder-sel")}$(b).addClass("ax-admin-folder-sel");this._selected=b;this._selected_name=b.getAttribute("n")||"";if(a){this.loadProperties()}},onclick:function(a){var b=a.target;var c=b.getAttribute("n");if(c&&c!="[TABS-TOP]"&&c!="[LINKS-TOP]"){this.selectNode(b,true)}},loadProperties:function(){this.$panelProperties.hide();this.$tbName.attr("disabled","disabled");this.$panelSetters.empty();this.$rowContent.hide();var b=$(this._selected).text();var a="";this.$tbTitle.val(b);this.$tbName.val(this._selected_name);this.$linkType.text("");this.$linkRoles.text("");this.$cbVisibility.attr("checked",false);this.$tbTitle.focus();Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/GetMapNode",{name:this._selected_name},this._service_onload)},service_onload:function(b){this.$panelProperties.show(300);var g=b.d;this.resTitle.setResValue(g.ResTitle);this.loadTypeText(g.Type,g.Content);this.loadRolesText(g.Roles,g.DenyRoles);this.$cbVisibility.attr("checked",g.Visible);var f=g.Ico;this.$logoIcon.html(f!=null?("<i class='ax-ico'>&#x"+f+"</i>"):"<i>&nbsp;&nbsp;&nbsp;</i>");var d="";var e=g.Setters;if(e){var a;for(var c=0;c<e.length;c++){a=$("<div style='padding:3px;'><label style='display:inline-block;width:12em;padding-left:2em;'>"+e[c].Name+"</label><input class='fm' style='width:25em;' disabled/></div>");$("INPUT",a).val(e[c].Value);this.$panelSetters.append(a)}}},loadRolesText:function(c,b){this.$linkRoles.attr("roles",c).attr("deny",b);var a=c;if(a==""){a="Everyone"}else{if(a=="Members"){a="Authenticated Users"}}if(b){a+=" /DENY: "+b}this.$linkRoles.text(a)},loadTypeText:function(a,b){if(b!=""){this.$linkType.text(a);this.$tbContent.val(b);this.$rowContent.show()}else{if(a!=""){this.$linkType.text(a+(b!=""?(" ("+b+")"):""))}else{this.$linkType.html("&lt;empty&gt;")}}switch(a){case"HTML":s="Html Page Name";break;case"PROFILE":s="Profile Name";break;case"NAVIGATOR":s="Profile Name";break;default:s="Settings";break}this.$lblContent.text(s)},title_onchange:function(b){var a=$(b.target).val().trim();$(this._selected).text(a);this.service_changeProperty("Title",a)},restitle_onchange:function(){this.service_changeProperty("ResTitle",this.resTitle.getResValue())},service_changeProperty:function(b,a,c){Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/ChangeMapNode",{name:this._selected_name,property:b,value:a},c)},service_deleteMapNode:function(a){Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/DeleteMapNode",{name:this._selected_name},a)},appendNode:function(a){var e=$(this.$panelAppend.html());var c=e.find("INPUT");var d=$(c[0]);var b=$(c[1]);d.blur(function(){if(b.val()==""){b.val(d.val().replace(/ /g,"_"))}});AX.Window.dialog("Add Menu Item",e,function(){var f=b.val().trim();var g=d.val().trim();if(f==""){f=g.replace(/ /g,"_")}if(f==""||g==""){return false}this.service_appendNode(f,g,a);return true},this);d.focus()},service_appendNode:function(b,d,a){var c=function(){var e=$("<div class='ax-admin-folder' draggable='true' n='"+b+"'></div>");e.text(d);if(a){this.$linksItems.append(e)}else{this.$tabsItems.append(e)}this.selectNode(e[0],true);$("#panelMenu",this.$p).parent().animate({scrollTop:e.offset().top+"px"},500)};Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/AddMapNode",{name:b,title:d,is_link:a,type:"",content:""},$createDelegate(c,this))},deleteNode:function(){if(this.$tabsItems.children().length==2){AX.Window.alert("You cannot delete this item.<br/>Application must contain at least one navigation tab.");return}var a=function(){$(this._selected).remove();this._selected=null;this._selected_name="";this.$panelProperties.hide(300)};this.service_deleteMapNode($createDelegate(a,this))},preventDefault:function(a){event.preventDefault();return true},ondragover:function(a){event.preventDefault();if(a.target.getAttribute("n")){$(a.target).addClass("ax-admin-folder-drag")}return true},ondragleave:function(a){event.preventDefault();if(a.target.getAttribute("n")){$(a.target).removeClass("ax-admin-folder-drag")}return true},ondragstart:function(a){this._dragItem=a.target;event.dataTransfer.effectAllowed="move";return true},ondrop:function(d){event.stopPropagation();if(d.target.getAttribute("n")){$(d.target).removeClass("ax-admin-folder-drag");if(this._dragItem&&this._dragItem!=d.target){var a=function(){$(this._dragItem).insertAfter(d.target);this._dragItem=null};var c=this._dragItem.getAttribute("n");var b=d.target.getAttribute("n");if(c&&b){Portal.ServiceRequest(AX.AdminPath+"AppManager/Service.asmx/MoveMapNode",{name:c,targetName:b},$createDelegate(a,this))}}}return false},on_btn_click:function(b){var a=b.target.getAttribute("cmd");switch(a){case"save":this.close(true);break;case"close":this.close(false);break;case"delete":AX.Window.confirm("Confirmation","Are you sure you want to delete this tab?",function(){this.deleteNode()},this);break;case"add-tab":this.appendNode(false);break;case"add-link":this.appendNode(true);break;case"permissions":this.permissions();break;case"content":this.changeContent();break;case"appsettigns":this.appSettings();break;case"theme":this.showThemes();break;default:alert(a);break}},showThemes:function(){var a=$("<div></div>");a.loadASCX(Portal.AdminPath+"AppManager/ThemesDialog.ascx",[Portal.AdminPath+"AppManager/AppDialogs.js"],function(){new Portal.AppThemesDialog(a)})},appSettings:function(){var a=$("<div></div>");a.loadASCX(Portal.AdminPath+"AppManager/AppSettings.ascx",[Portal.AdminPath+"AppManager/AppDialogs.js"],function(){new Portal.AppSettingsDialog(a)})},permissions:function(){var e=this.$tbTitle.val();var c=this.$linkRoles.attr("roles");var b=this.$linkRoles.attr("deny");var a=$createDelegate(this.roles_onchange,this);var d=$("<div></div>");d.loadASCX(Portal.AdminPath+"AppManager/PermissionDialog.ascx",[Portal.AdminPath+"AppManager/AppDialogs.js"],function(){new Portal.PermissionDialog(d,this._selected_name,e,c,b,a)})},changeContent:function(){var b=this._selected_name;var a=$createDelegate(this.loadTypeText,this);var c=$("<div></div>");c.loadASCX(Portal.AdminPath+"AppManager/ChangeContent.ascx",[Portal.AdminPath+"AppManager/AppDialogs.js"],function(){new Portal.ChangeContentDialog(c,b,null,a)})},roles_onchange:function(b,a){this.service_changeProperty("Roles",b+"|"+a);this.loadRolesText(b,a)},openIconDialog:function(){var a=$createDelegate(this.onIconSelected,this);if(!AX.IconGalleryDialog){Runtime_ResourceLoader.LoadResources([Portal.AdminPath+"ThemeManager/AX.IconGalleryDialog.js"],function(){var b=new AX.IconGalleryDialog();b.onSelect=a;window.AX.IconGalleryDialog.Current=b})}else{AX.IconGalleryDialog.Current.Show();AX.IconGalleryDialog.Current.onSelect=a}},onIconSelected:function(a){this.$logoIcon.html(a?("<i class='ax-ico'>&#x"+a+"</i>"):"&nbsp;&nbsp;");this.service_changeProperty("Ico",a)},on_visibility_click:function(){var a=this.$cbVisibility.is(":checked");var d=this._selected;var c=function(){$(d).toggleClass("ax-admin-folder-dis",!a)};this.service_changeProperty("Visibile",a,c)},close:function(d){var e=this._selected_name;var c=$("#panelMenu",this.$p);var b=function(){window.location.href=e?("#"+e):"/";window.location.reload()};var a=function(){c.hide(150,b)};this.$panelProperties.hide(300,a)}};Portal.AddContentDialog=function(){var b=document.location.href.substr(document.location.href.indexOf("/#")+2);var a=App_Reload;var c=$("<div></div>");c.loadASCX(Portal.AdminPath+"AppManager/ChangeContent.ascx",[Portal.AdminPath+"admin_utils.js",Portal.AdminPath+"AppManager/AppDialogs.js"],function(){new Portal.ChangeContentDialog(c,b,null,a)})};Portal.ResTitle=function(a,c){this.$tb=a;this.childNodes=a.parent().children();this.isMulti=(this.childNodes.length>2);this.restitle_loaded=false;if(this.isMulti){this.$lang=$(this.childNodes[this.childNodes.length-1]);this.tb_mas=new Array();this.tb_mas.push(this.childNodes[0]);for(var d=1;d<this.childNodes.length-1;d++){var b=this.childNodes[d];this.tb_mas.push(b);if(c!=null){$(b).addHandler("change",this.restb_onchange,this)}}this._current=0;this.restitle_onchange=c;this.$lang.addHandler("change",this.lang_onchange,this)}};Portal.ResTitle.prototype={loadResValues:function(){this.restitle_loaded=true;for(var a=1;a<this.tb_mas.length;a++){var d=this.tb_mas[a].getAttribute("lcid");var c="";if(this.restitle!=""){var e=this.restitle.indexOf(d+":");if(e!=-1){var b=this.restitle.indexOf("|",e+5);c=(b!=-1)?this.restitle.substr(e+5,b-e-5):this.restitle.substr(e+5)}}this.tb_mas[a].value0=c;this.tb_mas[a].value=c}},restb_onchange:function(c){var a=c.target;var b=a.value.trim();if(a.value0!=b){a.value0=b;this.restitle_onchange()}},lang_onchange:function(){if(!this.restitle_loaded){this.loadResValues()}var a=this.$lang[0].selectedIndex;if(this._current!=a){this.tb_mas[this._current].style.display="none";this._current=a;this.tb_mas[this._current].style.display=""}},setValue:function(a){this.$tb.val(a)},getValue:function(){return this.$tb.val().trim()},setResValue:function(a){this.restitle=a||"";if(this.isMulti&&this.tb_mas){this.restitle_loaded=false;this.$tb.show();this.$lang[0].selectedIndex=this._current=0;for(var b=1;b<this.tb_mas.length;b++){$(this.tb_mas[b]).hide().val("")}}},getResValue:function(){if(!this.isMulti){return this.restitle}var d="";for(var c=1;c<this.tb_mas.length;c++){var a=this.tb_mas[c];var b=a.value.trim();if(b!=""){if(d.length>0){d+="|"}d+=a.getAttribute("lcid")+":"+b}}return d}};